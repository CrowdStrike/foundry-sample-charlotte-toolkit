import{r as e,j as t,R as s,i as n,d as a,c as i,t as r,s as o,o as c,a as l,b as d,e as m,f as u,g as p,h,M as f,k as y,l as x,m as g,n as v,p as _,q as b,u as N,F as w,v as T,w as j}from"./vendor-mf4bob09t8l.js";class k extends e.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError(e,t)}handleReset=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:t.jsxs("div",{className:"error-boundary-container p-6 rounded-lg",style:{backgroundColor:"var(--cs-background-base)",border:"1px solid var(--cs-border-color-light)",borderRadius:"var(--spacing-base)",padding:"var(--spacing-3xl)"},children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("svg",{className:"h-5 w-5",style:{color:"var(--cs-status-error)"},xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),t.jsx("div",{className:"ml-3",children:t.jsx("h3",{className:"text-sm font-medium",style:{color:"var(--cs-status-error)"},children:"Something went wrong"})})]}),t.jsx("div",{className:"text-sm mb-4",style:{color:"var(--cs-text-primary)"},children:t.jsx("p",{children:"The application encountered an unexpected error. Please try refreshing the page or contact support if the problem persists."})}),this.state.error&&t.jsxs("details",{className:"mb-4",children:[t.jsx("summary",{className:"text-sm font-medium cursor-pointer hover:opacity-80",style:{color:"var(--cs-status-error)"},children:"Error Details"}),t.jsxs("div",{className:"mt-2 text-xs font-mono p-2 rounded border",style:{color:"var(--cs-text-secondary)",fontFamily:"var(--font-family-mono)",backgroundColor:"var(--cs-background-lighter)",border:"1px solid var(--cs-border-color-light)",padding:"var(--spacing-lg)",borderRadius:"var(--spacing-sm)"},children:[t.jsxs("div",{className:"mb-2",children:[t.jsx("strong",{children:"Error:"})," ",this.state.error.message]}),this.state.errorInfo&&t.jsxs("div",{children:[t.jsx("strong",{children:"Component Stack:"}),t.jsx("pre",{className:"whitespace-pre-wrap mt-1",children:this.state.errorInfo.componentStack})]})]})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{type:"button",onClick:this.handleReset,className:"inline-flex items-center px-3 py-2 border shadow-sm text-sm leading-4 font-medium rounded-md hover:opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2",style:{borderColor:"var(--cs-border-color-light)",color:"var(--cs-text-primary)",backgroundColor:"var(--cs-background-base)",focusRingColor:"var(--cs-primary)"},children:"Try Again"}),t.jsx("button",{type:"button",onClick:this.props.onRetry,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md hover:opacity-80 focus:outline-none focus:ring-2 focus:ring-offset-2",style:{color:"white",backgroundColor:"var(--cs-status-error)",focusRingColor:"var(--cs-status-error)"},children:"Refresh Page"})]})]}):this.props.children}}const C='Conduct a comprehensive security analysis of {entityType} "{entityValue}" and provide a structured assessment including:\n\n**🔍 {analysisType} ANALYSIS**\n- {contextSpecific}\n- Threat classification (Malicious/Suspicious/Clean/Unknown)\n- Risk level (Critical/High/Medium/Low)\n\n**⚔️ THREAT INTELLIGENCE**\n- Known malicious activities and associations\n- Malware families or campaigns linked to this {entityType}\n- MITRE ATT&CK techniques if applicable\n\n**🎯 INCIDENT CONTEXT**\n- Relevance to current investigation\n- {responseActions}\n- Associated IOCs for hunting and blocking\n\n**🚨 RESPONSE ACTIONS**\n- Immediate containment and mitigation steps\n- Detection rules and monitoring recommendations\n- Investigation and forensic analysis guidance\n\n**📊 CONFIDENCE ASSESSMENT**\n- Analysis confidence level (High/Medium/Low)\n- Data source reliability and validation\n- Recommended next steps for verification\n\nProvide specific, actionable guidance for SOC analysts and incident responders.',S=(e,t="SHA256")=>`Conduct a comprehensive malware analysis of ${t} hash "${e}" and provide a structured security assessment including:\n\n**🦠 MALWARE ANALYSIS**\n- Threat classification (Malicious/Suspicious/Clean/Unknown)\n- Malware family and variant identification\n- Risk level (Critical/High/Medium/Low)\n\n**⚔️ ATTACK INTELLIGENCE**\n- Primary malware functions and capabilities\n- MITRE ATT&CK techniques and tactics\n- Persistence mechanisms and behavior patterns\n\n**🎯 INCIDENT CONTEXT**\n- Relevance to current investigation\n- Associated file names and execution contexts\n- Related IOCs for hunting (domains, IPs, registry keys)\n\n**🚨 RESPONSE ACTIONS**\n- Immediate containment and isolation steps\n- Detection rules and hunting queries\n- Remediation and cleanup guidance\n\n**📊 CONFIDENCE ASSESSMENT**\n- Analysis confidence level (High/Medium/Low)\n- Threat intelligence source reliability\n- Recommended validation and sandbox analysis\n\nProvide specific, actionable guidance for incident response and threat hunting.`,E=(e,t,s)=>{switch(e){case"domain":return d=t,C.replace(/{entityType}/g,"domain").replace(/{entityValue}/g,d).replace(/{analysisType}/g,"DOMAIN").replace(/{contextSpecific}/g,"Registration details and ownership information").replace(/{responseActions}/g,"Common attack vectors and associated subdomains/URLs");case"file":return s?.hashType?S(t,s.hashType):(l=t,C.replace(/{entityType}/g,"file").replace(/{entityValue}/g,l).replace(/{analysisType}/g,"FILE").replace(/{contextSpecific}/g,"File type, format identification, and behavioral analysis").replace(/{responseActions}/g,"Associated hashes, registry keys, and network indicators"));case"ip":return c=t,C.replace(/{entityType}/g,"IP address").replace(/{entityValue}/g,c).replace(/{analysisType}/g,"IP").replace(/{contextSpecific}/g,"Geolocation, ISP information, and network infrastructure").replace(/{responseActions}/g,"Network communication patterns, ports, and associated domains");case"fqdn":return o=t,C.replace(/{entityType}/g,"hostname").replace(/{entityValue}/g,o).replace(/{analysisType}/g,"HOSTNAME").replace(/{contextSpecific}/g,"DNS resolution and infrastructure details").replace(/{responseActions}/g,"Network services, certificates, and subdomain patterns");case"hostname":return r=t,C.replace(/{entityType}/g,"hostname").replace(/{entityValue}/g,r).replace(/{analysisType}/g,"HOSTNAME").replace(/{contextSpecific}/g,"System identification and network infrastructure").replace(/{responseActions}/g,"Network connections, services, and associated processes");case"user":return i=t,C.replace(/{entityType}/g,"user account").replace(/{entityValue}/g,i).replace(/{analysisType}/g,"USER ACCOUNT").replace(/{contextSpecific}/g,"Account privileges, activity patterns, and authentication details").replace(/{responseActions}/g,"Login history, privilege escalation attempts, and associated processes");case"mitre":return n=t,a=s?.techniqueName,`Conduct a comprehensive analysis of MITRE ATT&CK technique "${a?`${n} - ${a}`:n}" and provide a structured assessment including:\n\n**🎯 TECHNIQUE ANALYSIS**\n- Technique overview and primary functionality\n- Attack methodology and implementation methods\n- Target systems and environments\n- Risk level and prevalence in real-world attacks\n\n**🔍 DETECTION & MONITORING**\n- Key indicators and detection signatures\n- Log sources and telemetry requirements\n- Behavioral patterns and anomaly detection\n- Detection rules and hunting queries\n\n**🛡️ MITIGATION & PREVENTION**\n- Specific security controls and countermeasures\n- Configuration hardening recommendations\n- Preventive technologies and solutions\n- Network and endpoint protection strategies\n\n**⚔️ THREAT INTELLIGENCE**\n- APT groups and malware families using this technique\n- Common attack chains and technique combinations\n- Geographic and sector targeting patterns\n- Recent campaigns and threat actor TTPs\n\n**🚨 INCIDENT RESPONSE**\n- Immediate containment and isolation steps\n- Forensic artifacts and evidence collection\n- Impact assessment and damage evaluation\n- Recovery and remediation guidance\n\n**📊 CONTEXTUAL ANALYSIS**\n- Related techniques and sub-techniques\n- Kill chain phase and tactical positioning\n- Difficulty level and skill requirements\n- Business impact and criticality assessment\n\nProvide specific, actionable guidance for security analysts, SOC teams, and incident responders dealing with this MITRE ATT&CK technique.`;default:{const s=e;return C.replace(/{entityType}/g,s).replace(/{entityValue}/g,t).replace(/{analysisType}/g,s.toUpperCase()).replace(/{contextSpecific}/g,"Entity-specific analysis and characteristics").replace(/{responseActions}/g,"Related indicators and attack patterns")}}var n,a,i,r,o,c,l,d},q=12,$=12,A="...",I=224,D=[".lan",".local",".internal",".corp",".intranet",".private",".domain",".ad"],M=e=>e.length<=32?e:`${e.slice(0,Math.max(0,q))}${A}${e.slice(Math.max(0,e.length-$))}`,R=(e,t=32)=>{if(e.length<=t)return e;const s=t-3;return s<=0?e:e.slice(0,Math.max(0,s))+"..."},L=e=>{const t=e.split(".").map(Number);if(4!==t.length||t.some(e=>Number.isNaN(Number(e))||e<0||e>255))return!1;const[s,n]=t;return 10!==s&&(!(172===s&&n>=16&&n<=31)&&((192!==s||168!==n)&&(127!==s&&((169!==s||254!==n)&&(0!==s&&!(s>=I))))))},O=e=>{if(!e.includes("."))return!1;if("."===e||"localhost"===e)return!1;if(/^\d+\.\d+\.\d+\.\d+$/.test(e))return!1;const t=e.split(".");if(t.length<2||(t.at(-1)?.length??0)<2)return!1;const s=e.toLowerCase();return!D.some(e=>s.endsWith(e))},F=e=>/^T\d{4}(\.\d{3})?$/.test(e.toUpperCase()),H=e=>{if(!e)return[];const t=[];if(e.mitre_techniques&&Array.isArray(e.mitre_techniques)){const s=new Map;e.mitre_techniques.forEach(e=>{const t=(e=>{if("string"==typeof e)return F(e)?e.toUpperCase():null;if(e&&"object"==typeof e){const t=[e.technique_id,e.techniqueId,e.id,e.technique];for(const e of t)if("string"==typeof e&&F(e))return e.toUpperCase()}return null})(e);if(t){const n=s.get(t)??{count:0};n.count+=1,e.name&&!n.techniqueName&&(n.techniqueName=e.name),e.tactic&&!n.tactic&&(n.tactic=e.tactic),s.set(t,n)}}),s.forEach(({techniqueName:e,tactic:s,count:n},a)=>{let i=a;e&&(i+=` - ${e}`),n>1&&(i+=` (${n} occurrences)`),t.push({value:`mitre:${a}`,displayName:i,type:"mitre",subType:"technique",queryTemplate:E("mitre",a,{techniqueName:e}),entityData:{techniqueId:a,techniqueName:e,tactic:s,count:n,sources:["incident_data"]}})})}return t},P=e=>{const t=[];return e?(((e,t)=>{e&&e.device&&(e.device.external_ip&&L(e.device.external_ip)&&t.push({value:e.device.external_ip.toLowerCase(),displayName:e.device.external_ip.toLowerCase(),type:"ip",queryTemplate:E("ip",e.device.external_ip),entityData:{ip:e.device.external_ip.toLowerCase()}}),e.device.local_ip&&L(e.device.local_ip)&&t.push({value:e.device.local_ip.toLowerCase(),displayName:e.device.local_ip.toLowerCase(),type:"ip",queryTemplate:E("ip",e.device.local_ip),entityData:{ip:e.device.local_ip.toLowerCase()}}))})(e,t),((e,t)=>{if(e){if(e.device){if(e.device.machine_domain&&O(e.device.machine_domain)){const s=e.device.machine_domain.toLowerCase(),n=R(s);t.push({value:`domain:${s}`,displayName:n,type:"domain",subType:"fqdn",queryTemplate:E("domain",s),entityData:{fullDomain:s,isTruncated:n!==s}})}if(e.device.hostinfo?.domain&&O(e.device.hostinfo.domain)){const s=e.device.hostinfo.domain.toLowerCase(),n=R(s);t.some(e=>e.value===`domain:${s}`)||t.push({value:`domain:${s}`,displayName:n,type:"domain",subType:"fqdn",queryTemplate:E("domain",s),entityData:{fullDomain:s,isTruncated:n!==s}})}}if(e.user_principal?.includes("@")){const s=e.user_principal.toLowerCase(),[,n]=s.split("@");if(n&&O(n)){const e=R(n);t.some(e=>e.value===`domain:${n}`)||t.push({value:`domain:${n}`,displayName:e,type:"domain",subType:"fqdn",queryTemplate:E("domain",n),entityData:{fullDomain:n,isTruncated:e!==n,source:"user_principal"}})}}}})(e,t),((e,t)=>{if(e){if(e.filename){const s=e.filename.toLowerCase();if(t.push({value:`file:${s}`,displayName:s,type:"file",subType:"filename",queryTemplate:E("file",s),entityData:{filename:s}}),e.sha256){const n=e.sha256.toLowerCase(),a=M(n);t.push({value:`sha256:${n}`,displayName:`SHA256: ${a}`,type:"file",subType:"sha256",parentFile:s,queryTemplate:S(n,"SHA256"),entityData:{hash:n,hashType:"SHA256",filename:s,isGrouped:!0}})}if(e.md5){const n=e.md5.toLowerCase(),a=M(n);t.some(e=>"sha256"===e.subType&&e.parentFile===s)||t.push({value:`md5:${n}`,displayName:`MD5: ${a}`,type:"file",subType:"md5",parentFile:s,queryTemplate:S(n,"MD5"),entityData:{hash:n,hashType:"MD5",filename:s,isGrouped:!0}})}if(e.sha1){const n=e.sha1.toLowerCase(),a=M(n);t.some(e=>"sha256"===e.subType&&e.parentFile===s)||t.push({value:`sha1:${n}`,displayName:`SHA1: ${a}`,type:"file",subType:"sha1",parentFile:s,queryTemplate:S(n,"SHA1"),entityData:{hash:n,hashType:"SHA1",filename:s,isGrouped:!0}})}}if(e.parent_details){const s=e.parent_details;if(s.filename){const e=s.filename.toLowerCase();if(!t.some(t=>t.value===`file:${e}`)){if(t.push({value:`file:${e}`,displayName:e,type:"file",subType:"filename",queryTemplate:E("file",e),entityData:{filename:e,source:"parent_process"}}),s.sha256){const n=s.sha256.toLowerCase(),a=M(n);t.push({value:`sha256:${n}`,displayName:`SHA256: ${a}`,type:"file",subType:"sha256",parentFile:e,queryTemplate:S(n,"SHA256"),entityData:{hash:n,hashType:"SHA256",filename:e,source:"parent_process",isGrouped:!0}})}if(s.md5){const n=s.md5.toLowerCase(),a=M(n);t.some(t=>"sha256"===t.subType&&t.parentFile===e)||t.push({value:`md5:${n}`,displayName:`MD5: ${a}`,type:"file",subType:"md5",parentFile:e,queryTemplate:S(n,"MD5"),entityData:{hash:n,hashType:"MD5",filename:e,source:"parent_process",isGrouped:!0}})}}}}if(e.grandparent_details){const s=e.grandparent_details;if(s.filename){const e=s.filename.toLowerCase();if(!t.some(t=>t.value===`file:${e}`)){if(t.push({value:`file:${e}`,displayName:e,type:"file",subType:"filename",queryTemplate:E("file",e),entityData:{filename:e,source:"grandparent_process"}}),s.sha256){const n=s.sha256.toLowerCase(),a=M(n);t.push({value:`sha256:${n}`,displayName:`SHA256: ${a}`,type:"file",subType:"sha256",parentFile:e,queryTemplate:S(n,"SHA256"),entityData:{hash:n,hashType:"SHA256",filename:e,source:"grandparent_process",isGrouped:!0}})}if(s.md5){const n=s.md5.toLowerCase(),a=M(n);t.some(t=>"sha256"===t.subType&&t.parentFile===e)||t.push({value:`md5:${n}`,displayName:`MD5: ${a}`,type:"file",subType:"md5",parentFile:e,queryTemplate:S(n,"MD5"),entityData:{hash:n,hashType:"MD5",filename:e,source:"grandparent_process",isGrouped:!0}})}}}}}})(e,t),((e,t)=>{if(!e)return;const s=new Map;if(e.behaviors&&Array.isArray(e.behaviors)&&e.behaviors.forEach(e=>{if(e.technique_id){const t=e.technique_id.toUpperCase();if(/^T\d{4}(\.\d{3})?$/.test(t)){const n=s.get(t)??{count:0,sources:[]};n.count+=1,n.sources.push("detection_behaviors"),e.technique&&!n.techniqueName&&(n.techniqueName=e.technique),e.tactic&&!n.tactic&&(n.tactic=e.tactic),s.set(t,n)}}}),e.kill_chain&&Array.isArray(e.kill_chain)&&e.kill_chain.forEach(e=>{if(e.technique_id){const t=e.technique_id.toUpperCase();if(/^T\d{4}(\.\d{3})?$/.test(t)){const n=s.get(t)??{count:0,sources:[]};n.count+=1,n.sources.push("kill_chain"),e.technique_name&&!n.techniqueName&&(n.techniqueName=e.technique_name),e.tactic&&!n.tactic&&(n.tactic=e.tactic),s.set(t,n)}}}),e.mitre_attack&&Array.isArray(e.mitre_attack)&&e.mitre_attack.forEach(e=>{if(e.technique_id){const t=e.technique_id.toUpperCase();if(/^T\d{4}(\.\d{3})?$/.test(t)){const n=s.get(t)??{count:0,sources:[]};n.count+=1,n.sources.push("mitre_attack"),e.technique&&!n.techniqueName&&(n.techniqueName=e.technique),e.tactic&&!n.tactic&&(n.tactic=e.tactic),s.set(t,n)}}}),e.technique_id){const t=e.technique_id.toUpperCase();if(/^T\d{4}(\.\d{3})?$/.test(t)){const n=s.get(t)??{count:0,sources:[]};n.count+=1,n.sources.push("detection_fields"),e.technique&&!n.techniqueName&&(n.techniqueName=e.technique),e.tactic&&!n.tactic&&(n.tactic=e.tactic),s.set(t,n)}}s.forEach(({techniqueName:e,tactic:s,count:n,sources:a},i)=>{let r=i;e&&(r+=` - ${e}`),n>1&&(r+=` (${n} occurrences)`),t.push({value:`mitre:${i}`,displayName:r,type:"mitre",subType:"technique",queryTemplate:E("mitre",i,{techniqueName:e}),entityData:{techniqueId:i,techniqueName:e,tactic:s,count:n,sources:a}})})})(e,t),t):t},z=e=>{if(!e)return[];const t=[];if(e.detection||e.detectionId){const s=P(e.detection);t.push(...s)}const s=e.incident?.entity_values;if(s){const n=e.incident?.entities_full??[],a=e.incident?.entities;t.push(...(e=>{if(!e)return[];const t=new Map;e.domain_names&&Array.isArray(e.domain_names)&&e.domain_names.forEach(e=>{if(e&&"string"==typeof e&&O(e)){const s=t.get(e)??{count:0,sources:[]};s.count+=1,s.sources.push("domain_names"),t.set(e,s)}}),e.email_addresses&&Array.isArray(e.email_addresses)&&e.email_addresses.forEach(e=>{const[,s]=e.split("@");if(s&&O(s)){const e=t.get(s)??{count:0,sources:[]};e.count+=1,e.sources.push("email_addresses"),t.set(s,e)}}),e.users&&Array.isArray(e.users)&&e.users.forEach(e=>{if(e&&"string"==typeof e&&e.includes("@")){const[,s]=e.split("@");if(s&&O(s)){const e=t.get(s)??{count:0,sources:[]};e.count+=1,e.sources.push("users"),t.set(s,e)}}}),e.host_names&&Array.isArray(e.host_names)&&e.host_names.forEach(e=>{if(e&&"string"==typeof e&&O(e)){const s=t.get(e)??{count:0,sources:[]};s.count+=1,s.sources.push("host_names"),t.set(e,s)}});const s=new Map;t.forEach(({count:e,sources:t},n)=>{const a=(e=>{const t=e.split(".");if(t.length<2)return e;const s=t.at(-1)?.toLowerCase()??"",n=t.at(-2)?.toLowerCase()??"",a=`${n}.${s}`;return["co.uk","com.au","org.uk","net.au","gov.uk","edu.au"].includes(a)&&t.length>=3?`${t.at(-3)}.${a}`:`${n}.${s}`})(n);s.has(a)||s.set(a,{domains:[],totalCount:0,allSources:[]});const i=s.get(a);i.domains.push(n),i.totalCount+=e,t.forEach(e=>{i.allSources.includes(e)||i.allSources.push(e)})});const n=[];return s.forEach(({domains:e,totalCount:s,allSources:a},i)=>{const r=s>1?`${i.toLowerCase()} (${s} instances)`:i.toLowerCase();n.push({value:`tld:${i}`,displayName:r,type:"domain",subType:"tld",queryTemplate:E("domain",i),entityData:{tld:i,domainCount:e.length,totalCount:s,sources:a}}),e.forEach(e=>{const s=t.get(e),a=R(e);n.push({value:`domain:${e}`,displayName:a.toLowerCase(),type:"domain",subType:"fqdn",parentDomain:i,queryTemplate:E("domain",e),entityData:{fullDomain:e,tld:i,count:s.count,sources:s.sources,isTruncated:a!==e}})})}),n})(s)),t.push(...((e,t)=>{if(!e||!t)return[];const s=[],n=new Map,a=e.sha256s??[],i=e.md5s??[],r=t?.file_name??[];if(r.length>0&&a.length>0&&r.length===a.length){for(const[e,t]of r.entries()){const s=a[e];t&&"string"==typeof t&&s&&"string"==typeof s&&(n.has(t)||n.set(t,{sha256Hashes:new Set,md5Hashes:new Set}),n.get(t).sha256Hashes.add(s))}if(i.length===r.length)for(const[e,t]of r.entries()){const s=i[e];t&&"string"==typeof t&&s&&"string"==typeof s&&(n.has(t)||n.set(t,{sha256Hashes:new Set,md5Hashes:new Set}),n.get(t).md5Hashes.add(s))}}else r.length>0&&r.forEach(e=>{e&&"string"==typeof e&&!n.has(e)&&n.set(e,{sha256Hashes:new Set,md5Hashes:new Set})});return n.forEach((e,t)=>{const{sha256Hashes:n,md5Hashes:a}=e;s.push({value:`file:${t}`,displayName:t.toLowerCase(),type:"file",subType:"filename",queryTemplate:E("file",t),entityData:{filename:t,sha256Count:n.size,md5Count:a.size}}),n.forEach(e=>{const n=M(e);s.push({value:`sha256:${e}`,displayName:`SHA256: ${n.toLowerCase()}`,type:"file",subType:"sha256",parentFile:t,queryTemplate:S(e,"SHA256"),entityData:{hash:e,hashType:"SHA256",filename:t,isGrouped:!0}})}),0===n.size&&a.size>0&&a.forEach(e=>{const n=M(e);s.push({value:`md5:${e}`,displayName:`MD5: ${n.toLowerCase()}`,type:"file",subType:"md5",parentFile:t,queryTemplate:S(e,"MD5"),entityData:{hash:e,hashType:"MD5",filename:t,isGrouped:!0}})})}),s})(s,a)),t.push(...((e,t)=>{const s=[];if(e&&Array.isArray(e)){const n=new Map;e.forEach(e=>{if(e?.FileName){const t=e.FileName;n.has(t)||n.set(t,{sha256Hashes:new Set,md5Hashes:new Set});const s=n.get(t);e.SHA256HashData&&"string"==typeof e.SHA256HashData&&s.sha256Hashes.add(e.SHA256HashData),e.MD5HashData&&"string"==typeof e.MD5HashData&&s.md5Hashes.add(e.MD5HashData)}}),n.forEach((e,n)=>{const{sha256Hashes:a,md5Hashes:i}=e;!t.some(e=>e.value===`file:${n}`&&"filename"===e.subType)&&(a.size>0||i.size>0)&&(s.push({value:`file:${n}`,displayName:n.toLowerCase(),type:"file",subType:"filename",queryTemplate:E("file",n),entityData:{filename:n,sha256Count:a.size,md5Count:i.size,isLegacy:!0}}),a.forEach(e=>{const a=`sha256:${e}`;if(!t.some(e=>e.value===a)){const t=M(e);s.push({value:a,displayName:`SHA256: ${t.toLowerCase()}`,type:"file",subType:"sha256",parentFile:n,queryTemplate:S(e,"SHA256"),entityData:{hash:e,hashType:"SHA256",filename:n,isLegacy:!0,isGrouped:!0}})}}),0===a.size&&i.size>0&&i.forEach(e=>{const a=`md5:${e}`;if(!t.some(e=>e.value===a)){const t=M(e);s.push({value:a,displayName:`MD5: ${t.toLowerCase()}`,type:"file",subType:"md5",parentFile:n,queryTemplate:S(e,"MD5"),entityData:{hash:e,hashType:"MD5",filename:n,isLegacy:!0,isGrouped:!0}})}}))})}return s})(n,t)),t.push(...(e=>{if(!e)return[];const t=[];return e.ipv4s&&Array.isArray(e.ipv4s)&&e.ipv4s.filter(L).forEach(e=>{t.push({value:e,displayName:e.toLowerCase(),type:"ip",queryTemplate:E("ip",e),entityData:{ip:e}})}),t})(s)),t.push(...H(s))}return t},W=[{format:"json",label:"JSON",icon:"code-square",description:"Complete structured data including request/response context"},{format:"markdown",label:"Markdown",icon:"markdown",description:"Formatted response with markdown styling"},{format:"plaintext",label:"Plain Text",icon:"file-text",description:"Clean text without formatting"}],U=(e,t,s,n)=>{switch(e){case"json":return n?JSON.stringify(n,null,2):s?JSON.stringify(s,null,2):JSON.stringify({response:t,timestamp:(new Date).toISOString()},null,2);case"markdown":return n?(e=>{if(!e)return"";let t="";return e.executive_summary&&(t+=`# Executive Summary\n\n${e.executive_summary}\n\n`),(e.threat_level||e.confidence_level)&&(t+="## Assessment\n\n",e.threat_level&&(t+=`**Threat Level:** ${e.threat_level}\n\n`),e.confidence_level&&(t+=`**Confidence Level:** ${e.confidence_level}\n\n`)),e.malware_analysis&&(t+="## Malware Analysis\n\n",e.malware_analysis.malware_family&&(t+=`**Family:** ${e.malware_analysis.malware_family}\n\n`),e.malware_analysis.variant_identification&&(t+=`**Variant:** ${e.malware_analysis.variant_identification}\n\n`),e.malware_analysis.threat_classification&&(t+=`**Classification:** ${e.malware_analysis.threat_classification}\n\n`),e.malware_analysis.risk_level&&(t+=`**Risk Level:** ${e.malware_analysis.risk_level}\n\n`)),e.attack_intelligence&&(t+="## Attack Intelligence\n\n",e.attack_intelligence.primary_functions&&e.attack_intelligence.primary_functions.length>0&&(t+="### Primary Functions\n",e.attack_intelligence.primary_functions.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.attack_intelligence.persistence_mechanisms&&e.attack_intelligence.persistence_mechanisms.length>0&&(t+="### Persistence Mechanisms\n",e.attack_intelligence.persistence_mechanisms.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.attack_intelligence.behavior_patterns&&e.attack_intelligence.behavior_patterns.length>0&&(t+="### Behavior Patterns\n",e.attack_intelligence.behavior_patterns.forEach(e=>{t+=`- ${e}\n`}),t+="\n")),e.incident_context&&(t+="## Incident Context\n\n",e.incident_context.investigation_relevance&&(t+=`**Investigation Relevance:** ${e.incident_context.investigation_relevance}\n\n`),e.incident_context.associated_filenames&&e.incident_context.associated_filenames.length>0&&(t+="### Associated Filenames\n",e.incident_context.associated_filenames.forEach(e=>{t+=`- \`${e}\`\n`}),t+="\n"),e.incident_context.related_iocs&&(t+="### Related IOCs for Hunting\n",e.incident_context.related_iocs.domains&&e.incident_context.related_iocs.domains.length>0&&(t+="**Domains:**\n",e.incident_context.related_iocs.domains.forEach(e=>{t+=`- \`${e}\`\n`}),t+="\n"),e.incident_context.related_iocs.ips&&e.incident_context.related_iocs.ips.length>0&&(t+="**IPs:**\n",e.incident_context.related_iocs.ips.forEach(e=>{t+=`- \`${e}\`\n`}),t+="\n"),e.incident_context.related_iocs.registry_keys&&e.incident_context.related_iocs.registry_keys.length>0&&(t+="**Registry Keys:**\n",e.incident_context.related_iocs.registry_keys.forEach(e=>{t+=`- \`${e}\`\n`}),t+="\n"),e.incident_context.related_iocs.hashes&&e.incident_context.related_iocs.hashes.length>0&&(t+="**Hashes:**\n",e.incident_context.related_iocs.hashes.forEach(e=>{t+=`- \`${e}\`\n`}),t+="\n"))),e.immediate_actions&&e.immediate_actions.length>0&&(t+="## Immediate Actions\n\n",e.immediate_actions.forEach((e,s)=>{t+=`${s+1}. ${e}\n`}),t+="\n"),e.response_actions&&(e.response_actions.immediate_containment&&e.response_actions.immediate_containment.length>0&&(t+="## Immediate Containment\n\n",e.response_actions.immediate_containment.forEach((e,s)=>{t+=`${s+1}. ${e}\n`}),t+="\n"),e.response_actions.detection_rules&&e.response_actions.detection_rules.length>0&&(t+="## Detection Rules\n\n",e.response_actions.detection_rules.forEach((e,s)=>{t+=`${s+1}. ${e}\n`}),t+="\n"),e.response_actions.remediation_guidance&&e.response_actions.remediation_guidance.length>0&&(t+="## Remediation Guidance\n\n",e.response_actions.remediation_guidance.forEach((e,s)=>{t+=`${s+1}. ${e}\n`}),t+="\n")),e.iocs&&Object.keys(e.iocs).length>0&&(t+="## Indicators of Compromise (IOCs)\n\n",e.iocs.hashes&&e.iocs.hashes.length>0&&(t+="### File Hashes\n",e.iocs.hashes.forEach(e=>{t+=`- \`${e}\`\n`}),t+="\n"),e.iocs.ips&&e.iocs.ips.length>0&&(t+="### IP Addresses\n",e.iocs.ips.forEach(e=>{t+=`- \`${e}\`\n`}),t+="\n"),e.iocs.domains&&e.iocs.domains.length>0&&(t+="### Domains\n",e.iocs.domains.forEach(e=>{t+=`- \`${e}\`\n`}),t+="\n"),e.iocs.urls&&e.iocs.urls.length>0&&(t+="### URLs\n",e.iocs.urls.forEach(e=>{t+=`- \`${e}\`\n`}),t+="\n"),e.iocs.file_paths&&e.iocs.file_paths.length>0&&(t+="### File Paths\n",e.iocs.file_paths.forEach(e=>{t+=`- \`${e}\`\n`}),t+="\n")),e.mitre_techniques&&e.mitre_techniques.length>0&&(t+="## MITRE ATT&CK Techniques\n\n",e.mitre_techniques.forEach(e=>{t+=`### ${e.technique_id}: ${e.technique_name}\n`,e.tactic&&(t+=`**Tactic:** ${e.tactic}\n`),e.description&&(t+=`${e.description}\n\n`)})),e.attack_intelligence?.mitre_techniques&&e.attack_intelligence.mitre_techniques.length>0&&(t+="## MITRE ATT&CK Techniques (Attack Intelligence)\n\n",e.attack_intelligence.mitre_techniques.forEach(e=>{t+=`### ${e.technique_id}: ${e.technique_name}\n`,e.tactic&&(t+=`**Tactic:** ${e.tactic}\n`),e.description&&(t+=`${e.description}\n\n`)})),e.technical_details&&(t+=`## Technical Details\n\n${e.technical_details}\n\n`),e.recommendations&&e.recommendations.length>0&&(t+="## Recommendations\n\n",e.recommendations.forEach((e,s)=>{t+=`${s+1}. ${e}\n`}),t+="\n"),(e.confidence_assessment||e.reasoning_assessment)&&(t+="## Confidence & Reasoning Assessment\n\n",e.confidence_assessment&&(t+="### Confidence Metrics\n",e.confidence_assessment.analysis_confidence&&(t+=`**Analysis Confidence:** ${e.confidence_assessment.analysis_confidence}\n`),e.confidence_assessment.source_reliability&&(t+=`**Source Reliability:** ${e.confidence_assessment.source_reliability}\n`),e.confidence_assessment.validation_recommendations&&e.confidence_assessment.validation_recommendations.length>0&&(t+="\n**Validation Recommendations:**\n",e.confidence_assessment.validation_recommendations.forEach(e=>{t+=`- ${e}\n`})),t+="\n"),e.reasoning_assessment&&(t+="### Charlotte's Analytical Methodology\n",t+=`${e.reasoning_assessment}\n\n`)),t})(n):t;case"plaintext":return n?(e=>{if(!e)return"";let t="";return e.executive_summary&&(t+=`EXECUTIVE SUMMARY\n${e.executive_summary}\n\n`),(e.threat_level||e.confidence_level)&&(t+="ASSESSMENT\n",e.threat_level&&(t+=`Threat Level: ${e.threat_level}\n`),e.confidence_level&&(t+=`Confidence Level: ${e.confidence_level}\n`),t+="\n"),e.malware_analysis&&(t+="MALWARE ANALYSIS\n",e.malware_analysis.malware_family&&(t+=`Family: ${e.malware_analysis.malware_family}\n`),e.malware_analysis.variant_identification&&(t+=`Variant: ${e.malware_analysis.variant_identification}\n`),e.malware_analysis.threat_classification&&(t+=`Classification: ${e.malware_analysis.threat_classification}\n`),e.malware_analysis.risk_level&&(t+=`Risk Level: ${e.malware_analysis.risk_level}\n`),t+="\n"),e.attack_intelligence&&(t+="ATTACK INTELLIGENCE\n",e.attack_intelligence.primary_functions&&e.attack_intelligence.primary_functions.length>0&&(t+="Primary Functions:\n",e.attack_intelligence.primary_functions.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.attack_intelligence.persistence_mechanisms&&e.attack_intelligence.persistence_mechanisms.length>0&&(t+="Persistence Mechanisms:\n",e.attack_intelligence.persistence_mechanisms.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.attack_intelligence.behavior_patterns&&e.attack_intelligence.behavior_patterns.length>0&&(t+="Behavior Patterns:\n",e.attack_intelligence.behavior_patterns.forEach(e=>{t+=`- ${e}\n`}),t+="\n")),e.incident_context&&(t+="INCIDENT CONTEXT\n",e.incident_context.investigation_relevance&&(t+=`Investigation Relevance: ${e.incident_context.investigation_relevance}\n\n`),e.incident_context.associated_filenames&&e.incident_context.associated_filenames.length>0&&(t+="Associated Filenames:\n",e.incident_context.associated_filenames.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.incident_context.related_iocs&&(t+="Related IOCs for Hunting:\n",e.incident_context.related_iocs.domains&&e.incident_context.related_iocs.domains.length>0&&(t+="Domains:\n",e.incident_context.related_iocs.domains.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.incident_context.related_iocs.ips&&e.incident_context.related_iocs.ips.length>0&&(t+="IPs:\n",e.incident_context.related_iocs.ips.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.incident_context.related_iocs.registry_keys&&e.incident_context.related_iocs.registry_keys.length>0&&(t+="Registry Keys:\n",e.incident_context.related_iocs.registry_keys.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.incident_context.related_iocs.hashes&&e.incident_context.related_iocs.hashes.length>0&&(t+="Hashes:\n",e.incident_context.related_iocs.hashes.forEach(e=>{t+=`- ${e}\n`}),t+="\n"))),e.immediate_actions&&e.immediate_actions.length>0&&(t+="IMMEDIATE ACTIONS\n",e.immediate_actions.forEach((e,s)=>{t+=`${s+1}. ${e}\n`}),t+="\n"),e.response_actions&&(e.response_actions.immediate_containment&&e.response_actions.immediate_containment.length>0&&(t+="IMMEDIATE CONTAINMENT\n",e.response_actions.immediate_containment.forEach((e,s)=>{t+=`${s+1}. ${e}\n`}),t+="\n"),e.response_actions.detection_rules&&e.response_actions.detection_rules.length>0&&(t+="DETECTION RULES\n",e.response_actions.detection_rules.forEach((e,s)=>{t+=`${s+1}. ${e}\n`}),t+="\n"),e.response_actions.remediation_guidance&&e.response_actions.remediation_guidance.length>0&&(t+="REMEDIATION GUIDANCE\n",e.response_actions.remediation_guidance.forEach((e,s)=>{t+=`${s+1}. ${e}\n`}),t+="\n")),e.iocs&&Object.keys(e.iocs).length>0&&(t+="INDICATORS OF COMPROMISE (IOCs)\n",e.iocs.hashes&&e.iocs.hashes.length>0&&(t+="File Hashes:\n",e.iocs.hashes.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.iocs.ips&&e.iocs.ips.length>0&&(t+="IP Addresses:\n",e.iocs.ips.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.iocs.domains&&e.iocs.domains.length>0&&(t+="Domains:\n",e.iocs.domains.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.iocs.urls&&e.iocs.urls.length>0&&(t+="URLs:\n",e.iocs.urls.forEach(e=>{t+=`- ${e}\n`}),t+="\n"),e.iocs.file_paths&&e.iocs.file_paths.length>0&&(t+="File Paths:\n",e.iocs.file_paths.forEach(e=>{t+=`- ${e}\n`}),t+="\n")),e.mitre_techniques&&e.mitre_techniques.length>0&&(t+="MITRE ATT&CK TECHNIQUES\n",e.mitre_techniques.forEach(e=>{t+=`${e.technique_id}: ${e.technique_name}\n`,e.description&&(t+=`${e.description}\n\n`)})),e.technical_details&&(t+=`TECHNICAL DETAILS\n${e.technical_details}\n\n`),e.recommendations&&e.recommendations.length>0&&(t+="RECOMMENDATIONS\n",e.recommendations.forEach((e,s)=>{t+=`${s+1}. ${e}\n`}),t+="\n"),(e.confidence_assessment||e.reasoning_assessment)&&(t+="CONFIDENCE & REASONING ASSESSMENT\n",e.confidence_assessment&&(t+="Confidence Metrics:\n",e.confidence_assessment.analysis_confidence&&(t+=`Analysis Confidence: ${e.confidence_assessment.analysis_confidence}\n`),e.confidence_assessment.source_reliability&&(t+=`Source Reliability: ${e.confidence_assessment.source_reliability}\n`),e.confidence_assessment.validation_recommendations&&e.confidence_assessment.validation_recommendations.length>0&&(t+="\nValidation Recommendations:\n",e.confidence_assessment.validation_recommendations.forEach(e=>{t+=`- ${e}\n`})),t+="\n"),e.reasoning_assessment&&(t+="Charlotte's Analytical Methodology:\n",t+=`${e.reasoning_assessment}\n\n`)),t})(n):(e=>{if(!e)return"";let t=e;return t=t.replace(/```[\s\S]*?```/g,""),t=t.replace(/`([^`]+)`/g,"$1"),t=t.replace(/^#{1,6}\s+/gm,""),t=t.replace(/\*\*([^*]+)\*\*/g,"$1"),t=t.replace(/\*([^*]+)\*/g,"$1"),t=t.replace(/__([^_]+)__/g,"$1"),t=t.replace(/_([^_]+)_/g,"$1"),t=t.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1"),t=t.replace(/^[\s]*[-*+]\s+/gm,""),t=t.replace(/^[\s]*\d+\.\s+/gm,""),t=t.replace(/^>\s*/gm,""),t=t.replace(/^[\s]*[-*_]{3,}[\s]*$/gm,""),t=t.replace(/\n\s*\n\s*\n/g,"\n\n"),t=t.replace(/^\s+|\s+$/g,""),t})(t);default:return t}},J=e=>{try{const t=JSON.parse(e.trim());if(t&&"object"==typeof t&&t.executive_summary&&t.threat_level&&t.priority_actions)return t}catch{}return null},G=()=>{const[t,s]=e.useState("clipboard");return{copyState:t,isSuccess:"check-circle"===t,copyToClipboard:e.useCallback(async(e,t=2e3)=>{try{await navigator.clipboard.writeText(e),s("check-circle"),setTimeout(()=>{s("clipboard")},t)}catch{}},[])}},V={"activity.detections.details":{socket:"activity.detections.details",displayName:"Activity Detections",description:"Activity app detection detail pages"},"ngsiem.workbench.details":{socket:"ngsiem.workbench.details",displayName:"Next-Gen SIEM",description:"Next-Gen SIEM workbench detail views"},"xdr.detections.panel":{socket:"xdr.detections.panel",displayName:"XDR Detections",description:"XDR detection panel views"}};function K(e){const t=function(){try{const e=window.location.href,t=window.parent?.location?.href??"",s=[e,t,window.top?.location?.href??""].filter(Boolean);for(const e of s){if(e.includes("/activity/")&&e.includes("/detections/"))return"activity.detections.details";if(e.includes("/ngsiem/")||e.includes("/workbench/"))return"ngsiem.workbench.details";if(e.includes("/xdr/")&&e.includes("/detections/"))return"xdr.detections.panel"}}catch{}return null}();if(t&&V[t]){const e=V[t];return{socket:e.socket,displayName:e.displayName,description:e.description,detected:!0,detectionMethod:"URL pattern analysis"}}const s=function(e){if(!e)return null;try{if(e.incident||e.ngsiem)return"ngsiem.workbench.details";if(e.detection)return e.detection.source?.includes("activity")||e.activity?"activity.detections.details":e.detection.source?.includes("xdr")||e.xdr?"xdr.detections.panel":"activity.detections.details"}catch{}return null}(e);if(s&&V[s]){const e=V[s];return{socket:e.socket,displayName:e.displayName,description:e.description,detected:!0,detectionMethod:"Falcon context analysis"}}const n=function(){try{const e=document.title?.toLowerCase()??"",t=window.parent?.document?.title?.toLowerCase()??"",s=[e,t,window.top?.document?.title?.toLowerCase()??""].filter(Boolean);for(const e of s){if(e.includes("activity")&&e.includes("detection"))return"activity.detections.details";if(e.includes("siem")||e.includes("workbench"))return"ngsiem.workbench.details";if(e.includes("xdr")&&e.includes("detection"))return"xdr.detections.panel"}}catch{}return null}();if(n&&V[n]){const e=V[n];return{socket:e.socket,displayName:e.displayName,description:e.description,detected:!0,detectionMethod:"Document title analysis"}}return{socket:"unknown",displayName:"Unknown Page",description:"Unable to detect current Falcon Console page",detected:!1,detectionMethod:"No detection method successful"}}const Q=[{value:"claude-latest",label:"Claude Latest"},{value:"claude-3-7-sonnet",label:"Claude 3.7 Sonnet"},{value:"gpt-4o",label:"GPT-4o"}],B=e=>{const t=Q.find(t=>t.value===e);return t?.label??e},Z=[{value:0,label:"0.0 - Precise"},{value:.1,label:"0.1"},{value:.2,label:"0.2 - Focused"},{value:.3,label:"0.3"},{value:.4,label:"0.4 - Balanced"},{value:.5,label:"0.5"},{value:.6,label:"0.6 - Flexible"},{value:.7,label:"0.7"},{value:.8,label:"0.8 - Varied"},{value:.9,label:"0.9"},{value:1,label:"1.0 - Creative"}],X=[],Y=[],ee=10,te=5e3,se=2e3,ne=5e4,ae=2e4,ie=(e=1e3)=>new Promise(t=>setTimeout(t,e)),re=e=>"string"==typeof e?e:e instanceof Error?e.message:e&&"object"==typeof e&&"message"in e?String(e.message):"An unexpected error occurred";let oe=function(e){return e.PENDING="Pending",e.IN_PROGRESS="InProgress",e.RUNNING="Running",e.COMPLETED="Completed",e.FAILED="Failed",e.UNKNOWN="Unknown",e}({});const ce={MAX_POLL_ATTEMPTS:90,WORKFLOW_NAME:"Charlotte Toolkit Chat Completion",WORKFLOW_DEPTH:0},le=e=>{const t=Object.keys(e).find(e=>e.includes(".completion")&&!e.includes(".meta")&&e.includes("llminvocator_handler"));return void 0===t?null:t},de=e=>{if(e.content)return e.content;if(e.response)return e.response;if(e.result)return e.result;if(e.output)return e.output;if("string"==typeof e)return e;const t=Object.keys(e).find(e=>e.endsWith(".completion")&&!e.includes(".meta"));return t&&"string"==typeof e[t]?e[t]:me(e)},me=e=>{const t=Object.keys(e);if(0===t.length)return"";const[s]=t;if(!s)return"";const n=e[s];if("string"==typeof n)return n;if(n&&"object"==typeof n){if(n.completion)return n.completion;if(n.content)return n.content}return""},ue=e=>{const t=Object.keys(e).filter(e=>e.includes("completion")||e.includes("content")||e.includes("response")||e.includes("result"));t.length>0&&t.forEach(e=>{})},pe=()=>JSON.stringify({type:"object",properties:{executive_summary:{type:"string",description:"Brief executive overview for leadership"},threat_level:{type:"string",enum:["Low","Medium","High","Critical"],description:"Overall threat severity"},confidence_level:{type:"string",enum:["Low","Medium","High"],description:"Analysis confidence level"},priority_actions:{type:"array",items:{type:"string",maxLength:150},maxItems:6,description:"Top priority security actions ranked by urgency and impact"},technical_details:{type:"string",maxLength:600,description:"Concise technical analysis and findings"},iocs:{type:"object",properties:{hashes:{type:"array",items:{type:"string"}},ips:{type:"array",items:{type:"string"}},domains:{type:"array",items:{type:"string"}},urls:{type:"array",items:{type:"string"}},file_paths:{type:"array",items:{type:"string"}}},description:"Indicators of Compromise when applicable"},mitre_techniques:{type:"array",items:{type:"object",properties:{technique_id:{type:"string"},technique_name:{type:"string"},description:{type:"string"}}},description:"MITRE ATT&CK techniques when applicable"},reasoning_assessment:{type:"string",maxLength:800,description:"Concise explanation of analytical methodology and confidence reasoning: data sources consulted, key decision factors, specific evidence supporting findings, and reasoning behind confidence levels. Focus on essential rationale rather than comprehensive details."}},required:["executive_summary","threat_level","confidence_level","priority_actions","technical_details","reasoning_assessment"]},null,2),he=()=>pe(),fe=()=>pe(),ye=()=>pe(),xe=()=>pe(),ge=()=>pe(),ve=()=>pe(),_e=e=>{const{query:t,model:s,temperature:n,selectedContext:a}=e,i=be(s);let r=t,o=e.jsonSchema;if(!1!==e.enablePromptEnhancement){if(r=t,!o?.trim()){const e=(e=>{const t=e.toLowerCase();return/\b[a-f0-9]{32}\b|\b[a-f0-9]{40}\b|\b[a-f0-9]{64}\b/i.test(e)?"hash_analysis":/\b(?:\d{1,3}\.){3}\d{1,3}\b/.test(e)?"ip_investigation":/\b[a-z0-9.-]+\.[a-z]{2,}\b/i.test(e)?"domain_analysis":t.includes("incident")||t.includes("response")||t.includes("containment")?"incident_response":t.includes("malware")||t.includes("virus")||t.includes("trojan")?"malware_analysis":t.includes("hunt")||t.includes("hunting")||t.includes("proactive")?"threat_hunting":"general_security"})(t);o=(e=>{switch(e){case"hash_analysis":case"malware_analysis":return he();case"ip_investigation":return fe();case"domain_analysis":return ye();case"incident_response":return xe();case"threat_hunting":return ge();default:return ve()}})(e)}}else r=t;const c={user_prompt:r,model_name:i,temperature:n};return Ne(c,e,o,a),c},be=e=>B(e),Ne=(e,t,s,n)=>{t.stopWords&&t.stopWords.length>0&&(e.stop_words=t.stopWords),s?.trim()&&(e.json_schema=s.trim()),t.dataToInclude&&t.dataToInclude.length>0&&(e.data_to_include=[...t.dataToInclude]),n?.trim()&&(e.data_to_include?e.data_to_include=[...e.data_to_include,n]:e.data_to_include=[n])},we=(e,t="")=>{(e=>{const t=JSON.stringify(e),s=new Blob([t]).size,n=t.length;let a="low";const i=[];s>ne?(a="high",i.push("Consider breaking down the request into smaller chunks")):s>ae&&(a="medium",i.push("Monitor response times for potential optimization")),e.user_prompt&&e.user_prompt.length>te&&i.push("Consider shortening the main prompt"),e.data_to_include&&e.data_to_include.length>ee-2&&i.push("Reduce context data for better focus"),e.json_schema&&e.json_schema.length>se&&i.push("Simplify JSON schema for faster processing")})(e)},Te=async(e,t)=>{const s=await e.api.workflows.getEntitiesExecutionResultsV1({ids:[t]});if(s.errors&&s.errors.length>0)throw new Error(s.errors[0]?.message??"Failed to get workflow results");if(!s.resources||0===s.resources.length)throw new Error("No workflow results found");const n=s.resources[0];return{status:ke(n.status),output_data:n.output_data,error:n.error}},je=e=>e===oe.IN_PROGRESS||e===oe.RUNNING||e===oe.PENDING,ke=e=>{const t=e?.trim().toLowerCase();switch(t){case"pending":return oe.PENDING;case"inprogress":case"in progress":return oe.IN_PROGRESS;case"running":return oe.RUNNING;case"completed":return oe.COMPLETED;case"failed":return oe.FAILED;default:return oe.UNKNOWN}},Ce=async(e,t)=>{let s,n,a;try{const i=(e=>e.query&&"string"==typeof e.query&&e.query.trim()?e.model&&"string"==typeof e.model?"number"!=typeof e.temperature||e.temperature<0||e.temperature>1?{isValid:!1,error:"Temperature must be between 0 and 1"}:e.stopWords&&!Array.isArray(e.stopWords)?{isValid:!1,error:"Stop words must be an array"}:e.stopWords&&e.stopWords.length>4?{isValid:!1,error:"Maximum 4 stop words allowed"}:e.jsonSchema&&"string"!=typeof e.jsonSchema?{isValid:!1,error:"JSON schema must be a string"}:e.dataToInclude&&!Array.isArray(e.dataToInclude)?{isValid:!1,error:"Data to include must be an array"}:{isValid:!0}:{isValid:!1,error:"Model is required"}:{isValid:!1,error:"Query is required"})(t);if(!i.isValid)return{success:!1,error:i.error??"Validation failed"};const r=null;if(r)return{success:!0,content:r,fromCache:!0};n=_e(t),we(n,"Workflow Execution");const o=await(async(e,t)=>{const s={name:ce.WORKFLOW_NAME,depth:ce.WORKFLOW_DEPTH},n=await e.api.workflows.postEntitiesExecuteV1(t,s);if(n.errors&&n.errors.length>0)throw new Error(n.errors[0]?.message??"Workflow execution failed");if(!n.resources||0===n.resources.length)throw new Error("No workflow execution ID returned");return n})(e,n);if([s]=o.resources,!s)throw new Error("No workflow ID received from execution");if(a=await(async(e,t,s={})=>{const{maxAttempts:n=ce.MAX_POLL_ATTEMPTS}=s;let a=0;const i=[];for(;a<n;)try{const s=await Te(e,t);if(i.push({attempt:a+1,timestamp:Date.now(),status:s.status,hasOutput:!!s.output_data}),s.status===oe.COMPLETED)return{status:oe.COMPLETED,...s.output_data&&{output_data:s.output_data},pollResults:i};if(s.status===oe.FAILED)return{status:oe.FAILED,error:s.error??"Workflow execution failed",pollResults:i};if(je(s.status)){if(a++,a<n){await ie(1e3);continue}throw new Error("Workflow execution timed out")}throw new Error(`Unknown workflow status: ${s.status}`)}catch(e){if(i.push({attempt:a+1,timestamp:Date.now(),error:e instanceof Error?e.message:String(e)}),a>=n-1)throw e;a++,await ie(1e3)}throw new Error("Workflow polling timed out after maximum attempts")})(e,s),a.status===oe.FAILED){return{success:!1,error:a.error??"Workflow execution failed"}}const c=(e=>{if(!e)throw new Error("No output data received from workflow");let t="";const s=le(e);if(t=s?e[s]:e.completion?e.completion:de(e),!t||"string"!=typeof t)throw ue(e),new Error("Unable to extract content from workflow output");if(!t.trim())throw new Error("Workflow completed but produced no content");return t.trim()})(a.output_data);return(e=>{const t=[];if(!e||"string"!=typeof e)return{isValid:!1,isEmpty:!0,wordCount:0,hasStructuredData:!1,estimatedFormat:"text",warnings:["Content is not a string or is null/undefined"]};const s=e.trim(),n=0===s.length,a=s.split(/\s+/).length;let i="text",r=!1;try{JSON.parse(s),i="json",r=!0}catch{s.includes("<")&&s.includes(">")?i="html":(s.includes("#")||s.includes("```"))&&(i="markdown")}n?t.push("Content is empty after trimming"):a<5?t.push("Content is very short (less than 5 words)"):a>5e3&&t.push("Content is very long (over 5000 words)"),(s.includes("Error:")||s.includes("error:"))&&t.push("Content appears to contain error messages")})(c),{success:!0,content:c,fromCache:!1}}catch(e){return{success:!1,error:re(e)}}},Se=({showJsonTab:s,setShowJsonTab:u,temperature:p,setTemperature:h,stopWords:f,setStopWords:y,jsonSchema:x,setJsonSchema:g,dataToInclude:v,setDataToInclude:_})=>{const[b,N]=e.useState(""),[w,T]=e.useState(""),j=()=>{b.trim()&&f.length<4&&(y([...f,b.trim()]),N(""))},k=()=>{w.trim()&&(_([...v,w.trim()]),T(""))};return t.jsx(a,{summary:"Advanced Options",className:"advanced-options-subtle",children:t.jsxs("div",{className:"flex flex-col gap-4 mt-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(i,{checked:s,onSlChange:e=>u(e.target.checked),children:"Show JSON objects"})}),t.jsx(r,{content:"Enable a JSON tab in the response to view complete request and response data for analysis and troubleshooting.",children:t.jsx(n,{name:"question-circle",className:"cursor-help",style:{color:"var(--cs-text-secondary)"}})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex-1",children:t.jsxs(o,{label:"Temperature",value:String(p),onSlChange:e=>h(Number.parseFloat(e.target.value)),children:[t.jsx(n,{slot:"prefix",name:"thermometer"}),Z.map(e=>t.jsx(c,{value:String(e.value),children:e.label},e.value))]})}),t.jsx(r,{content:"Controls randomness. Lowering results in less random completions. As the temperature approaches zero, the model will become deterministic and repetitive.",children:t.jsx(n,{name:"question-circle",className:"cursor-help",style:{color:"var(--cs-text-secondary)"}})})]}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Stop Sequences"}),f.length>0?t.jsx("div",{className:"flex flex-wrap gap-2 mb-2 min-h-[32px] p-2 rounded",style:{border:"1px solid var(--cs-border-color-light)",backgroundColor:"var(--cs-background-light)"},children:f.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded text-sm",style:{backgroundColor:"var(--cs-background-light)",color:"var(--cs-text-primary)"},children:[t.jsx("span",{children:e}),t.jsx("button",{type:"button",onClick:()=>(e=>{y(f.filter((t,s)=>s!==e))})(s),className:"hover:opacity-80 transition-opacity",style:{color:"var(--cs-status-info)"},children:t.jsx(n,{name:"x",style:{fontSize:"var(--font-size-sm)"}})})]},s))}):t.jsx("p",{className:"text-sm mb-2 italic",style:{color:"var(--cs-text-secondary)"},children:"Optional: Add stop sequences to control output termination"}),f.length<4&&t.jsxs("div",{className:"flex gap-2",children:[t.jsx(l,{placeholder:"Enter stop sequence",value:b,onSlInput:e=>N(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),j())}}),t.jsx(d,{size:"small",onClick:j,disabled:!b.trim(),children:t.jsx(n,{name:"plus"})})]}),f.length>=4&&t.jsx("p",{className:"text-sm",style:{color:"var(--cs-text-secondary)"},children:"Maximum 4 stop sequences allowed"})]}),t.jsx(r,{content:"Up to 4 sequences where API will stop generating further tokens. The return text will not contain the stop sequence.",children:t.jsx(n,{name:"question-circle",className:"cursor-help mt-6",style:{color:"var(--cs-text-secondary)"}})})]}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("div",{className:"flex-1",children:t.jsx(m,{label:"JSON Schema",value:x,placeholder:"Enter JSON schema to define response structure...",rows:4,onSlInput:e=>g(e.target.value),children:t.jsx(n,{slot:"prefix",name:"code-square"})})}),t.jsx(r,{content:"JSON schema is used to define the structure of the model's response format.",children:t.jsx(n,{name:"question-circle",className:"cursor-help mt-6",style:{color:"var(--cs-text-secondary)"}})})]}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Data to Include"}),v.length>0?t.jsx("div",{className:"flex flex-wrap gap-2 mb-2 min-h-[32px] p-2 rounded",style:{border:"1px solid var(--cs-border-color-light)",backgroundColor:"var(--cs-background-light)"},children:v.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded text-sm",style:{backgroundColor:"var(--cs-background-light)",color:"var(--cs-text-primary)"},children:[t.jsx("span",{children:e}),t.jsx("button",{type:"button",onClick:()=>(e=>{_(v.filter((t,s)=>s!==e))})(s),className:"hover:opacity-80 transition-opacity",style:{color:"var(--cs-status-warning)"},children:t.jsx(n,{name:"x",style:{fontSize:"var(--font-size-sm)"}})})]},s))}):t.jsx("p",{className:"text-sm mb-2 italic",style:{color:"var(--cs-text-secondary)"},children:"Optional: Add custom data to enhance your analysis"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(l,{placeholder:"Enter additional data",value:w,onSlInput:e=>T(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),k())}}),t.jsx(d,{size:"small",onClick:k,disabled:!w.trim(),children:t.jsx(n,{name:"plus"})})]})]}),t.jsx(r,{content:"Additional key-value pairs provided from the trigger or preceding action output fields. This data is appended to the user prompt.",children:t.jsx(n,{name:"question-circle",className:"cursor-help mt-6",style:{color:"var(--cs-text-secondary)"}})})]})]})})},Ee=({originalText:e,displayText:s,children:n,placement:a="top"})=>e!==s?t.jsx(r,{content:e,placement:a,hoist:!0,className:"truncated-text-tooltip",trigger:"hover focus",distance:8,children:n}):t.jsx(t.Fragment,{children:n}),qe=({selectedContextEntity:e,setSelectedContextEntity:a,availableContextOptions:i,setQuery:l})=>{const d=0===i.length,m=e=>!!(e.parentFile??e.parentDomain??["md5","sha256","fqdn"].includes(e.subType??""));if(d)return t.jsx(r,{content:"No context detected for this incident",children:t.jsx("div",{className:"opacity-60 cursor-not-allowed",children:t.jsxs(o,{label:"Incident Context",value:"",disabled:!0,children:[t.jsx(n,{slot:"prefix",name:"layers"}),t.jsx(c,{value:"",disabled:!0,children:"No entities available"})]})})});const h={domain:i.filter(e=>"domain"===e.type).length,file:i.filter(e=>"file"===e.type).length,ip:i.filter(e=>"ip"===e.type).length,mitre:i.filter(e=>"mitre"===e.type).length};return t.jsxs(o,{label:"Incident Context",value:e??"",onSlChange:e=>{const t=e.target.value;if(t){const e=i.find(e=>e.value===t);e&&(a(t),l(e.queryTemplate))}else a(null)},children:[t.jsx(n,{slot:"prefix",name:"layers"}),t.jsx(c,{value:"",children:"None Selected"}),["domain","file","ip","mitre"].map((e,a)=>{const r=i.filter(t=>t.type===e);if(0===r.length)return null;const o={domain:{name:"Domains",icon:"shield-exclamation"},file:{name:"Files",icon:"file-lock"},ip:{name:"IP Addresses",icon:"router-fill"},mitre:{name:"MITRE ATT&CK",icon:"shield-exclamation"}}[e];if(!o)return null;const l=h[e];return t.jsxs(s.Fragment,{children:[a>0&&t.jsx(u,{}),t.jsxs("small",{className:"context-group-header",children:[t.jsx(n,{name:o.icon,className:"mr-2"}),o.name,t.jsx(p,{className:"ml-2 context-entity-badge",children:l})]}),r.map(e=>t.jsxs(c,{value:e.value,className:m(e)?"child-option":"",children:[("md5"===e.subType||"sha256"===e.subType)&&t.jsx(n,{slot:"prefix",name:"fingerprint"}),"fqdn"===e.subType&&t.jsx(n,{slot:"prefix",name:"globe"}),"tld"===e.subType&&t.jsx(n,{slot:"prefix",name:"shield-exclamation"}),"filename"===e.subType&&t.jsx(n,{slot:"prefix",name:"file-earmark"}),"technique"===e.subType&&t.jsx(n,{slot:"prefix",name:"shield-exclamation"}),"ip"===e.type&&!e.subType&&t.jsx(n,{slot:"prefix",name:"router"}),"domain"===e.type&&!e.subType&&t.jsx(n,{slot:"prefix",name:"shield-exclamation"}),"mitre"===e.type&&!e.subType&&t.jsx(n,{slot:"prefix",name:"shield-exclamation"}),"file"===e.type&&!e.subType&&t.jsx(n,{slot:"prefix",name:"file-lock"}),(()=>{try{const s=(e=>{if("md5"===e.subType||"sha256"===e.subType){const t=e.displayName.match(/^(MD5|SHA256):\s*(.+)$/);if(t?.[1]&&t[2]){const[,s,n]=t,a=e.entityData?.hash;if(a&&a!==n)return{displayText:e.displayName,originalText:`${s}: ${a}`}}}if("domain"===e.type&&"fqdn"===e.subType&&e.entityData){const{fullDomain:t,isTruncated:s}=e.entityData;if(s&&t)return{displayText:e.displayName,originalText:t}}return{displayText:e.displayName,originalText:e.displayName}})(e);if(!s||"object"!=typeof s)return t.jsx(Ee,{originalText:e.displayName,displayText:e.displayName,children:e.displayName});const{displayText:n,originalText:a}=s;return t.jsx(Ee,{originalText:a,displayText:n,children:n})}catch(s){return t.jsx(Ee,{originalText:e.displayName,displayText:e.displayName,children:e.displayName})}})()]},e.value))]},e)})]})},$e=({query:s,setQuery:a})=>{const i=e.useRef(null);e.useEffect(()=>{if(i.current){const e=i.current;e.style.transition="none",setTimeout(()=>{e.style.height="auto";const t=Math.max(e.scrollHeight,96);e.style.height=`${t}px`,setTimeout(()=>{e.style.transition="height 0.15s ease-out"},50)},50)}},[]);return t.jsx("div",{className:"relative min-h-[120px] z-10",children:t.jsx(m,{ref:i,label:"Prompt",value:s,rows:5,resize:"none",placeholder:"Enter your security analysis question...",onSlInput:e=>{const t=e.target.value;if(i.current){const e=i.current,t=e.offsetHeight,s=Math.min(e.scrollHeight,300);Math.abs(s-t)>2&&(e.style.height=`${s}px`)}a(t)},children:t.jsx(n,{slot:"prefix",name:"chat-quote"})})})},Ae=({quotaAcknowledged:e,setQuotaAcknowledged:s,loading:a,query:r,handleSubmit:o})=>{const c=!r||""===r.trim(),l=a||c||!e;return t.jsx("div",{className:"flex flex-col gap-3 mt-3",children:t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsx(i,{size:"small",checked:e,onSlChange:e=>s(e.target.checked),children:"I understand this will use Charlotte AI credits"}),t.jsxs(d,{variant:"primary",size:"medium",disabled:l,onClick:o,children:[t.jsx(n,{slot:"prefix",name:a?"hourglass-split":"send"}),a?"Analyzing...":"Analyze with Charlotte"]})]})})},Ie=s.memo(({query:e,setQuery:s,modelName:a,setModelName:i,temperature:r,setTemperature:l,stopWords:d,setStopWords:m,jsonSchema:u,setJsonSchema:p,dataToInclude:h,setDataToInclude:f,loading:y,handleSubmit:x,selectedContextEntity:g,setSelectedContextEntity:v,availableContextOptions:_,showJsonTab:b,setShowJsonTab:N,quotaAcknowledged:w,setQuotaAcknowledged:T})=>t.jsxs("div",{className:"flex flex-col gap-4 isolate",children:[t.jsx(qe,{selectedContextEntity:g,setSelectedContextEntity:v,availableContextOptions:_,setQuery:s}),t.jsx($e,{query:e,setQuery:s}),t.jsxs(o,{label:"Model",defaultValue:a,value:a,onSlChange:e=>{const t=e.target;i(t.value)},children:[t.jsx(n,{slot:"prefix",name:"cpu"}),Q.map(e=>t.jsx(c,{value:e.value,children:e.label},e.value))]}),t.jsx(Ae,{quotaAcknowledged:w,setQuotaAcknowledged:T,loading:y,query:e,handleSubmit:x}),t.jsx(Se,{showJsonTab:b,setShowJsonTab:N,temperature:r,setTemperature:l,stopWords:d,setStopWords:m,jsonSchema:u,setJsonSchema:p,dataToInclude:h,setDataToInclude:f})]}));Ie.displayName="QueryForm";const De=({children:e,className:s})=>{const{copyState:a,copyToClipboard:i}=G(),o=s?.replace("language-","")??"text";return t.jsxs("div",{className:"relative group",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx(p,{variant:"neutral",children:o}),t.jsx(r,{content:"check-circle"===a?"Copied to clipboard!":`Copy ${o} code to clipboard`,placement:"top",distance:8,hoist:!0,children:t.jsx(d,{size:"small",variant:"text",onClick:()=>{i(String(e))},className:"compact-copy-btn opacity-0 group-hover:opacity-100 transition-opacity "+("check-circle"===a?"copy-success":"text-body-and-labels"),children:t.jsx(n,{name:a})})})]}),t.jsx("pre",{className:"enhanced-code-block",children:t.jsx("code",{className:s,children:e})})]})},Me=e=>{if(!e||"string"!=typeof e)return null;if(/^[a-fA-F0-9]{32}$|^[a-fA-F0-9]{40}$|^[a-fA-F0-9]{64}$/.test(e))return"hash";if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)[.[\].]){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e))return"ip";if(/^[a-zA-Z0-9][a-zA-Z0-9\-[\].-]{1,61}[a-zA-Z0-9][.[\].][a-zA-Z]{2,}$/.test(e))return"domain";if(/^https?:\/\//.test(e)||e.includes("://"))return"url";if(/^HK[A-Z_]+(\\|\/).+/.test(e))return"registry";return/^[a-zA-Z]:\\|^\/|\\/.test(e)||e.includes("\\")||e.includes("/")?"path":null},Re=e=>e&&"string"==typeof e?e.replace(/\./g,"[.]").replace(/http/g,"hxxp").replace(/ftp/g,"fxp"):e,Le=e=>{switch(e){case"hash":return"warning";case"ip":return"primary";case"domain":case"url":default:return"neutral";case"registry":case"path":return"success"}},Oe=({children:e,className:s})=>{const a=String(e),i=Me(a),{copyState:o,copyToClipboard:c}=G(),l=e=>{e.stopPropagation(),c(a)};if(i){const e=Le(i),s=Re(a);return t.jsxs("span",{className:"inline-flex items-center gap-1 ioc-container",children:[t.jsx(p,{variant:e,className:"text-xs",children:i.toUpperCase()}),t.jsx(r,{content:"check-circle"===o?"Copied to clipboard!":`Click to copy ${i} to clipboard`,placement:"top",distance:8,hoist:!0,children:t.jsx("code",{className:"ioc-code cursor-pointer ioc-hover-bg transition-colors",onClick:l,children:s})}),t.jsx(r,{content:"check-circle"===o?"Copied to clipboard!":`Copy ${i} to clipboard for further analysis`,placement:"top",distance:8,hoist:!0,children:t.jsx(n,{name:o,className:"text-xs cursor-pointer ioc-hover-text "+("check-circle"===o?"copy-success":"secondary-text"),onClick:l})})]})}return t.jsx("code",{className:s,children:e})},Fe=({level:e,children:t,...a})=>{const i=`h${e}`,r=String(t).toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),o={1:"file-text",2:"list-ul",3:"chevron-right",4:"dot",5:"dot",6:"dot"}[e]||"dot";return s.createElement(i,{id:r,className:"group flex items-center gap-2",...a},s.createElement(n,{name:o,className:"text-sm flex-shrink-0"}),t)},He=({children:e,...t})=>s.createElement("li",{className:"flex items-start gap-2",...t},s.createElement(n,{name:"dot",className:"secondary-text text-sm mt-0.5 flex-shrink-0"}),s.createElement("span",null,e)),Pe=({iocs:s})=>{const[a,i]=e.useState({}),o=e.useCallback(async(e,t)=>{try{await navigator.clipboard.writeText(e),i(s=>({...s,[`${t}-${e}`]:!0})),setTimeout(()=>{i(s=>({...s,[`${t}-${e}`]:!1}))},2e3)}catch{}},[]),c=(e,s)=>e&&0!==e.length?t.jsxs("div",{className:"ioc-section-spacing",children:[t.jsx("div",{className:"ioc-type-header",children:t.jsxs("span",{className:"text-sm font-semibold",children:[s.toUpperCase(),"S (",e.length,")"]})}),t.jsx("div",{className:"space-y-2",children:e.map((e,i)=>{const c=Re(e);return t.jsx("div",{className:"ioc-value-item",children:t.jsxs("div",{className:"flex items-center gap-1 p-0",children:[t.jsx("code",{className:"flex-1 text-xs font-mono min-w-0 break-all",children:c}),t.jsx(r,{content:a[`${s}-${e}`]?"Copied to clipboard!":`Copy ${s} to clipboard for further analysis`,placement:"top",distance:8,hoist:!0,children:t.jsx(d,{size:"small",variant:"text",onClick:()=>o(e,s),className:"compact-copy-btn ioc-copy-btn flex-shrink-0",children:t.jsx(n,{name:a[`${s}-${e}`]?"check-circle":"clipboard",className:a[`${s}-${e}`]?"copy-success":"secondary-text"})})})]})},i)})})]}):null;return t.jsxs("div",{children:[c(s.hashes,"hash"),c(s.ips,"ip"),c(s.domains,"domain"),c(s.urls,"url"),c(s.file_paths,"path")]})},ze=e=>t=>{if(!t||"string"!=typeof t)return[];const s=t.replace(/\s+/g," ").trim(),n=s.split(/(?<=[.!?])\s+(?=[A-Z])/).map(e=>e.trim()).filter(e=>e.length>0);if(n.length<=e.shortTextThreshold)return[s];const a=[];let i=[];return n.forEach((t,s)=>{i.push(t);const r=i.length>=e.maxSentencesPerParagraph,o=s===n.length-1,c=e.aggressiveBreaking&&i.length>0&&s<n.length-1&&e.breakKeywords.some(e=>t.includes(e));(r||o||c)&&(a.push(i.join(" ")),i=[])}),a.filter(e=>e.length>0)},We={default:ze({maxSentencesPerParagraph:3,shortTextThreshold:2,breakKeywords:["Additionally","Furthermore","However","This technique","Attackers"],aggressiveBreaking:!0}),mitre:ze({maxSentencesPerParagraph:2,shortTextThreshold:1,breakKeywords:["This technique","Attackers","Adversaries","The malware","Additionally","Furthermore","However","For example","In some cases","Common methods","Detection methods","Mitigation strategies","executed","implemented","utilized","performed","Windows","Linux","macOS","registry","file system","network","process"],aggressiveBreaking:!0}),summary:ze({maxSentencesPerParagraph:3,shortTextThreshold:3,breakKeywords:["Additionally","However","Furthermore"],aggressiveBreaking:!0}),technical:ze({maxSentencesPerParagraph:5,shortTextThreshold:4,breakKeywords:["Additionally","Furthermore","However","The analysis","This indicates","Based on"],aggressiveBreaking:!0}),reasoning:ze({maxSentencesPerParagraph:2,shortTextThreshold:1,breakKeywords:["The analysis","This assessment","Based on the","The evidence","However","Additionally","Furthermore","Therefore","In conclusion","This indicates","The reasoning","Charlotte","data sources","analytical methods","decision factors","confidence level","limitations","assumptions","probability","likelihood","assessment shows","evaluation indicates","analysis reveals","findings suggest","results demonstrate","investigation","methodology","approach","consideration","factor","criteria","metric","measurement","validation","verification"],aggressiveBreaking:!0})},Ue=We.default,Je=We.mitre,Ge=({techniques:s})=>{const[a,i]=e.useState({}),o=e.useCallback(async(e,t)=>{try{await navigator.clipboard.writeText(e),i(e=>({...e,[t]:!0})),setTimeout(()=>{i(e=>({...e,[t]:!1}))},2e3)}catch{}},[]);if(!s||0===s.length)return null;return t.jsx("div",{className:"mitre-techniques-container space-y-3",children:s.map((e,s)=>{const i=Je(e.description),c=(e=>{const t={"initial-access":["initial access","exploit","phishing","drive-by"],execution:["execution","command","script","powershell","rundll32"],persistence:["persistence","registry","startup","scheduled task"],"privilege-escalation":["privilege escalation","escalate","token","uac bypass"],"defense-evasion":["defense evasion","obfuscat","masquerade","disable","hide"],"credential-access":["credential","password","hash","keylog","dump"],discovery:["discovery","enumerate","network","system information"],"lateral-movement":["lateral movement","remote","psexec","wmi"],collection:["collection","data","clipboard","screen capture"],"command-control":["command and control","c2","communication","channel"],exfiltration:["exfiltration","steal","transfer","upload"],impact:["impact","destroy","encrypt","ransom","wipe"]},s=`${e.description.toLowerCase()||""} ${e.technique_name.toLowerCase()||""}`;for(const[e,n]of Object.entries(t))if(n.some(e=>s.includes(e)))return e;return null})(e),l=(e=>{if(!e)return"neutral";switch(e){case"initial-access":case"execution":return"warning";case"persistence":case"privilege-escalation":return"danger";case"defense-evasion":case"credential-access":return"primary";case"discovery":case"lateral-movement":return"success";default:return"neutral"}})(c),m=(e=>e?e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"")(c);return t.jsxs("div",{className:"mitre-technique-card enhanced-card",children:[t.jsx("div",{className:"technique-header",children:t.jsxs("div",{className:"technique-title-section",children:[t.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[t.jsx(n,{name:"shield-check",className:"technique-icon flex-shrink-0"}),t.jsx("span",{className:"technique-id",children:e.technique_id}),t.jsx(r,{content:a[e.technique_id]?"Copied to clipboard!":"Copy MITRE URL to clipboard",placement:"top",distance:8,hoist:!0,children:t.jsx(d,{size:"small",variant:"text",onClick:()=>o(`https://attack.mitre.org/techniques/${e.technique_id.replace(".","/")}/`,e.technique_id),className:"compact-copy-btn ioc-copy-btn flex-shrink-0",children:t.jsx(n,{name:a[e.technique_id]?"check-circle":"clipboard",className:a[e.technique_id]?"copy-success":"secondary-text"})})})]}),t.jsx("div",{className:"technique-name-line mb-1",children:t.jsx("span",{className:"technique-name",children:e.technique_name})}),m&&t.jsx("div",{className:"tactic-badge-container mb-3",children:t.jsx(p,{variant:l,className:"text-xs w-fit tactic-badge",children:m})})]})}),t.jsx("div",{className:"technique-description",children:i.length>0?i.map((e,s)=>t.jsx("p",{className:"text-sm sm:text-base secondary-text leading-relaxed break-words technique-paragraph",children:e},s)):t.jsx("p",{className:"text-sm sm:text-base secondary-text leading-relaxed break-words technique-paragraph",children:e.description})})]},s)})})},Ve=(e,t="technical")=>{if(!e||"string"!=typeof e)return[];switch(t){case"mitre":return Je(e);case"summary":return We.summary(e);case"technical":return We.technical(e);case"reasoning":return We.reasoning(e);default:return Ue(e)}},Ke=e=>{if(!e||"string"!=typeof e)return!1;return e.split(/[.!?]/).filter(e=>e.trim().length>0).length>2},Qe=e=>{switch(e.toLowerCase()){case"critical":return"danger";case"high":return"warning";case"medium":default:return"neutral";case"low":return"success"}},Be=e=>{switch(e.toLowerCase()){case"high":return"success";case"medium":return"warning";default:return"neutral"}},Ze=({data:e,renderers:s})=>{const a=e.priority_actions;return t.jsxs("div",{className:"structured-analysis space-y-2 sm:space-y-4",children:[t.jsxs(h,{className:"executive-summary-card",children:[t.jsxs("h3",{className:"flex items-center gap-1 sm:gap-2 text-base sm:text-lg font-bold mb-2 sm:mb-3",children:[t.jsx(n,{name:"clipboard-data",className:"flex-shrink-0"}),t.jsx("span",{className:"break-words",children:"Executive Summary"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-1 sm:gap-2 mb-3",children:[t.jsxs(p,{variant:Qe(e.threat_level),className:"text-xs sm:text-sm w-fit",children:[e.threat_level," Threat"]}),t.jsxs(p,{variant:Be(e.confidence_level),className:"text-xs sm:text-sm w-fit",children:[e.confidence_level," Confidence"]})]}),Ke(e.executive_summary)?Ve(e.executive_summary,"summary").map((e,s)=>t.jsx("p",{className:"text-sm sm:text-base leading-relaxed break-words formatted-paragraph",children:e},s)):t.jsx("p",{className:"text-sm sm:text-base leading-relaxed break-words",children:e.executive_summary})]}),e.iocs&&((e.iocs.hashes?.length??0)>0||(e.iocs.ips?.length??0)>0||(e.iocs.domains?.length??0)>0||(e.iocs.urls?.length??0)>0||(e.iocs.file_paths?.length??0)>0)&&t.jsxs(h,{className:"iocs-card",children:[t.jsxs("h3",{className:"flex items-center gap-1 sm:gap-2 text-base sm:text-lg font-bold mb-2 sm:mb-3",children:[t.jsx(n,{name:"shield-exclamation",className:"flex-shrink-0"}),t.jsx("span",{className:"break-words",children:"IOC Details"})]}),t.jsx(Pe,{iocs:e.iocs})]}),e.mitre_techniques&&e.mitre_techniques.length>0&&t.jsxs(h,{className:"mitre-details",children:[t.jsxs("h3",{className:"flex items-center gap-1 sm:gap-2 text-base sm:text-lg font-bold mb-2 sm:mb-3",children:[t.jsx(n,{name:"diagram-3",className:"flex-shrink-0"}),t.jsxs("span",{className:"break-words",children:["MITRE ATT&CK Techniques (",e.mitre_techniques.length,")"]})]}),t.jsx(Ge,{techniques:e.mitre_techniques})]}),e.technical_details&&t.jsxs(h,{className:"technical-details",children:[t.jsxs("h3",{className:"flex items-center gap-1 sm:gap-2 text-base sm:text-lg font-bold mb-2 sm:mb-3",children:[t.jsx(n,{name:"gear",className:"flex-shrink-0"}),t.jsx("span",{className:"break-words",children:"Technical Analysis"})]}),t.jsx("div",{className:"prose prose-sm max-w-none",children:Ke(e.technical_details)?t.jsx("div",{className:"technical-details-formatted",children:Ve(e.technical_details,"technical").map((e,n)=>t.jsx("div",{className:"technical-paragraph",children:t.jsx(f,{components:s,children:e})},n))}):t.jsx(f,{components:s,children:e.technical_details})})]}),a.length>0&&t.jsxs(h,{className:"recommendations-details",children:[t.jsxs("h3",{className:"flex items-center gap-1 sm:gap-2 text-base sm:text-lg font-bold mb-2 sm:mb-3",children:[t.jsx(n,{name:"lightbulb",className:"flex-shrink-0"}),t.jsxs("span",{className:"break-words",children:["Priority Actions (",a.length,")"]})]}),t.jsx("ul",{className:"compact-bullet-list",children:a.map((e,s)=>t.jsxs("li",{className:"recommendation-item",children:[t.jsx(n,{name:"dot",className:"secondary-text mt-0.5 flex-shrink-0"}),t.jsx("span",{className:"text-sm sm:text-base break-words",children:e})]},s))})]}),e.reasoning_assessment&&t.jsxs(h,{className:"analysis-methodology-card",children:[t.jsxs("h3",{className:"flex items-center gap-1 sm:gap-2 text-base sm:text-lg font-bold mb-2 sm:mb-3",children:[t.jsx(n,{name:"lightbulb",className:"flex-shrink-0"}),t.jsx("span",{className:"break-words",children:"Analysis Methodology"})]}),t.jsxs("div",{className:"reasoning-content",children:[t.jsx("strong",{className:"text-sm font-semibold mb-2 block",children:"Charlotte's Analytical Methodology:"}),Ke(e.reasoning_assessment)?Ve(e.reasoning_assessment,"reasoning").map((e,s)=>t.jsx("p",{className:"text-sm sm:text-base leading-relaxed break-words formatted-paragraph",children:e},s)):t.jsx("p",{className:"text-sm sm:text-base leading-relaxed break-words",children:e.reasoning_assessment})]})]})]})},Xe=e=>{let t=e;return t=t.replace(/^(IPs?:)\s*([0-9.]+(?:\s+[0-9.]+)+)\s*$/gim,(e,t,s)=>`${t}\n${s.trim().split(/\s+/).map(e=>`- \`${e}\``).join("\n")}`),t=t.replace(/^(\s*)\d+\.\s*(.+)\n(\s*[-*•]\s*.+)/gim,(e,t,s,n)=>{const a=n.replace(/^(\s*)[-*•]\s*/gm,"   • ");return`${t}• **${s.trim()}**\n${a}`}),t=t.replace(/([.!?])\s+([A-Z][^.!?]*[.!?])\s+([A-Z][^.!?]*[.!?])\s+([A-Z][^.!?]*[.!?])/g,"$1\n\n$2 $3\n\n$4"),t=t.replace(/\b(However|Additionally|Furthermore|Therefore|Based on|The analysis|This assessment),/g,"\n\n$1,"),t=t.replace(/^(\s*[-*•]\s*)([a-zA-Z0-9_.-]+\.exe)(?!`)(\s*)$/gim,"$1`$2`$3"),t=t.replace(/^(\s*[-*•]\s*)([a-fA-F0-9]{32,64})(?!`)(\s*)$/gim,"$1`$2`$3"),t=t.replace(/^(\s*[-*•]\s*)(HK[A-Z_\\]+[^`\n]*)(?!`)(\s*)$/gim,"$1`$2`$3"),t=t.replace(/^(#{1,6}\s*(?:Recommended Actions?|Security Recommendations?|Recommendations?)[\s\S]*?)^(?=#{1,6}|\n*$)/gim,e=>`<div class="markdown-recommendations">\n${e}\n</div>`),t=t.replace(/\n{4,}/g,"\n\n\n"),t=t.replace(/\s+$/gm,""),t},Ye=s.memo(({loading:e,responseText:a,errorMessage:i})=>{const r={code:({_node:e,inline:t,className:n,children:a,...i})=>t?s.createElement(Oe,{className:n,...i},a):s.createElement(De,{className:n,...i},a),heading:({_node:e,level:t,children:n,...a})=>s.createElement(Fe,{level:t,...a},n),li:({_node:e,children:t,...n})=>s.createElement(He,{...n},t)},[o,c]=s.useState("Gathering information...");if(s.useEffect(()=>{if(e){c("Gathering information...");const e=setTimeout(()=>{c("Processing data...")},8e3),t=setTimeout(()=>{c("Compiling results...")},16e3);return()=>{clearTimeout(e),clearTimeout(t)}}return()=>{}},[e]),e)return t.jsxs("div",{className:"loading-container",children:[t.jsx("div",{className:"loading-backdrop"}),t.jsx("div",{className:"loading-icon-container",children:t.jsx(y,{style:{"--track-width":"3px","--track-color":"var(--cs-border-color-light, #e2e8f0)","--indicator-color":"var(--cs-color-primary, #0ea5e9)","--speed":"2.5s",fontSize:"var(--font-size-4xl)",filter:"drop-shadow(0 0 8px rgba(14, 165, 233, 0.3))"}})}),t.jsx("p",{className:"loading-text-pulse",children:o})]});if(i)return t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-96 gap-3",style:{color:"var(--cs-status-error)"},children:[t.jsx(n,{name:"exclamation-triangle"}),t.jsx("p",{className:"text-base text-center",children:i})]});if(!a)return t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-96 gap-3",style:{color:"var(--cs-text-secondary)"},children:[t.jsx(n,{name:"chat-square-text"}),t.jsx("p",{className:"text-base",children:"Submit a query to see analysis results"})]});const l=J(a);return l?t.jsxs("div",{className:"response-scroll-container",children:[t.jsx("div",{className:"response-scroll-content",children:t.jsx(Ze,{data:l,renderers:r})}),t.jsx("div",{className:"response-scroll-fade"})]}):t.jsxs("div",{className:"response-scroll-container",children:[t.jsx("div",{className:"response-scroll-content",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"p-3 rounded-lg",style:{backgroundColor:"var(--cs-background-light)",border:"1px solid var(--cs-border-color-medium)"},children:[t.jsx("p",{className:"text-sm font-medium",style:{color:"var(--cs-status-warning)"},children:"⚠️ Response Format Issue"}),t.jsx("p",{className:"text-sm mt-1",style:{color:"var(--cs-text-secondary)"},children:"Charlotte AI did not return the expected JSON format. Displaying as markdown instead."})]}),t.jsx(f,{components:r,children:Xe(a)})]})}),t.jsx("div",{className:"response-scroll-fade"})]})});Ye.displayName="ResponseDisplay";const et=s.memo(({falcon:a})=>{const[i,r]=e.useState({query:"",modelName:"claude-latest",temperature:.1,stopWords:X,jsonSchema:"",dataToInclude:Y,responseText:"",status:"",loading:!1,errorMessage:"",hasSubmittedQuery:!1,selectedContextEntity:null,showJsonTab:!1,quotaAcknowledged:!1,executionStartTime:null,executionEndTime:null}),{availableContextOptions:o}=(({falconData:t})=>{const s=e.useMemo(()=>z(t),[t]),n=e.useMemo(()=>{return{total:(e=s).length,domains:e.filter(e=>"domain"===e.type).length,files:e.filter(e=>"file"===e.type).length,ips:e.filter(e=>"ip"===e.type).length,mitres:e.filter(e=>"mitre"===e.type).length};var e},[s]);return{availableContextOptions:s,contextCounts:n}})({falconData:a?.data}),c={total:o.length,domains:o.filter(e=>"domain"===e.type).length,files:o.filter(e=>"file"===e.type).length,ips:o.filter(e=>"ip"===e.type).length,fqdns:o.filter(e=>"domain"===e.type&&"fqdn"===e.subType).length},{jsonContextData:l,initializeRequestData:m,updateRequestData:u,updateResponseData:p,copyFalconContext:f,copyRequestData:y,contextCopyState:w,requestCopyState:T}=(({falconData:t,availableContextOptions:s,contextCounts:n})=>{const[a,i]=e.useState(null),{copyState:r,copyToClipboard:o}=G(),{copyState:c,copyToClipboard:l}=G(),{copyState:d,copyToClipboard:m}=G(),{copyState:u,copyToClipboard:p}=G();e.useEffect(()=>{if(t){const e={socket_info:K(t),falcon_object:{full_data:t,data_structure:Object.keys(t),incident:t.incident??null,detection:t.detection??null,available_entities:s,entity_counts:{total_entities:n.total,domains:n.domains,files:n.files,ips:n.ips,fqdns:n.fqdns}}};i({falcon_context:e})}},[t,s,n]);const h=e.useCallback(e=>{const t=(new Date).toISOString(),s={...a,request_data:{timestamp:t,parameters:e}};return i(s),s},[a]),f=e.useCallback(e=>{i(t=>t?{...t,request_data:{timestamp:t.request_data?.timestamp??"",parameters:e}}:t)},[]),y=e.useCallback(e=>{i(t=>{if(!t)return t;const s={timestamp:e.executionEndTime,execution_time_ms:new Date(e.executionEndTime).getTime()-new Date(e.executionStartTime).getTime(),success:e.success,from_cache:e.fromCache??!1,content:e.content??null,content_length:e.content?.length??0,error:e.error??null,workflow_result:e.workflowResult};return{...t,response_data:s}})},[]),x=e.useCallback(async()=>{const e=a?.falcon_context??{};await o(JSON.stringify(e,null,2))},[a,o]),g=e.useCallback(async()=>{const e=a?.request_data??{};await l(JSON.stringify(e,null,2))},[a,l]),v=e.useCallback(async()=>{if(!a?.response_data)return void await m(JSON.stringify({},null,2));const e=a.response_data,{content:t,...s}=e;await m(JSON.stringify(s,null,2))},[a,m]),_=e.useCallback(async()=>{const e=a?.response_data?.content??"";await p(e)},[a,p]);return{jsonContextData:a,initializeRequestData:h,updateRequestData:f,updateResponseData:y,copyFalconContext:x,copyRequestData:g,copyResponseData:v,copyRawResponse:_,contextCopyState:r,requestCopyState:c,responseCopyState:d,rawResponseCopyState:u}})({falconData:a?.data,availableContextOptions:o,contextCounts:c}),{tabGroupRef:j,handleTabChange:k,setActiveTab:C,getResponseTabIndicator:S}=(({hasSubmittedQuery:t,loading:a,errorMessage:i,responseText:r})=>{const[o,c]=e.useState("request"),l=e.useRef(null),d=e.useCallback(e=>{c(e.detail.name)},[]);e.useEffect(()=>{l.current&&o&&l.current.show(o)},[o]);const m=e.useCallback(()=>t?a?s.createElement(n,{name:"hourglass-split",className:"mr-2",style:{color:"var(--cs-status-info)"}}):i?s.createElement(n,{name:"exclamation-triangle",className:"mr-2",style:{color:"var(--cs-status-error)"}}):r?s.createElement(n,{name:"check-circle",className:"mr-2",style:{color:"var(--cs-status-success)"}}):null:null,[t,a,i,r]);return{activeTab:o,tabGroupRef:l,handleTabChange:d,setActiveTab:c,getResponseTabIndicator:m}})({hasSubmittedQuery:i.hasSubmittedQuery,loading:i.loading,errorMessage:i.errorMessage,responseText:i.responseText}),{copyState:E,handleCopyFormat:q,copyOptions:$}=(({responseText:t,jsonContextData:s})=>{const{copyState:n,isSuccess:a,copyToClipboard:i}=G();return{copyState:n,isSuccess:a,handleCopyFormat:e.useCallback(async e=>{const n=J(t),a=U(e,t,s,n);await i(a)},[t,s,i]),copyOptions:W}})({responseText:i.responseText,jsonContextData:l}),{copyState:A,copyToClipboard:I}=G(),D=e.useCallback(e=>{r(t=>({...t,...e}))},[]);e.useEffect(()=>{if(l&&(i.query||i.modelName||i.temperature||i.jsonSchema||i.selectedContextEntity)){const e={query:i.query,model:B(i.modelName),temperature:i.temperature,stopWords:i.stopWords,jsonSchema:i.jsonSchema,dataToInclude:i.dataToInclude,selectedContext:i.selectedContextEntity??""};u(e)}},[i.query,i.modelName,i.temperature,i.stopWords,i.jsonSchema,i.dataToInclude,i.selectedContextEntity,l,u]);const M=e.useCallback(async()=>{const e=(e=>{if(!e||"string"!=typeof e)return{isValid:!1,error:"Query is required"};const t=e.trim();return 0===t.length?{isValid:!1,error:"Query cannot be empty"}:t.length>1e4?{isValid:!1,error:"Query is too long (max 10,000 characters)"}:{isValid:!0}})(i.query);if(!e.isValid)return void r(t=>({...t,errorMessage:e.error??"Invalid query"}));const t=(new Date).toISOString(),s={query:i.query,model:B(i.modelName),temperature:i.temperature,stopWords:i.stopWords,jsonSchema:i.jsonSchema,dataToInclude:i.dataToInclude,selectedContext:i.selectedContextEntity??""};m(s),r(e=>({...e,hasSubmittedQuery:!0,loading:!0,status:"Gathering details...",responseText:"",errorMessage:""})),C("response");try{const e={query:i.query,model:B(i.modelName),temperature:i.temperature,stopWords:i.stopWords,jsonSchema:i.jsonSchema,dataToInclude:i.dataToInclude,selectedContext:i.selectedContextEntity??""},s=await Ce(a,e),n=(new Date).toISOString();p({executionEndTime:n,executionStartTime:t,success:s.success,fromCache:s.fromCache,content:s.content,error:s.error,workflowResult:s}),s.success&&s.content?r(e=>({...e,responseText:s.content??"",status:s.fromCache?"Done (cached)":"Done",loading:!1,errorMessage:"",quotaAcknowledged:!1,executionStartTime:t,executionEndTime:n})):r(e=>({...e,responseText:"",errorMessage:s.error??"Unknown error occurred",status:"Error",loading:!1,executionStartTime:t,executionEndTime:n}))}catch(e){const s=re(e),n=(new Date).toISOString();p({executionEndTime:n,executionStartTime:t,success:!1,error:s,workflowResult:{exception:{message:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:null}}}),r(e=>({...e,responseText:"",errorMessage:`Error: ${s}`,status:"Error",loading:!1,executionStartTime:t,executionEndTime:n}))}},[i.query,i.modelName,i.temperature,i.stopWords,i.jsonSchema,i.dataToInclude,i.selectedContextEntity,a,m,p,C]);return t.jsx("div",{className:"w-full py-2",children:t.jsx(h,{className:"full-width-card",children:t.jsxs(x,{ref:j,placement:"top",onSlTabShow:k,children:[t.jsxs(g,{slot:"nav",panel:"request",children:[t.jsx(n,{name:"pencil",className:"mr-2"}),"Request"]}),t.jsxs(g,{slot:"nav",panel:"response",disabled:!i.hasSubmittedQuery,className:i.hasSubmittedQuery?"":"opacity-50 cursor-not-allowed",children:[S(),"Response"]}),i.showJsonTab?t.jsxs(g,{slot:"nav",panel:"json",children:[t.jsx(n,{name:"code-square",className:"mr-2"}),"JSON"]}):null,t.jsx(v,{name:"request",children:t.jsx(Ie,{query:i.query,setQuery:e=>D({query:e}),modelName:i.modelName,setModelName:e=>D({modelName:e}),temperature:i.temperature,setTemperature:e=>D({temperature:e}),stopWords:i.stopWords,setStopWords:e=>D({stopWords:e}),jsonSchema:i.jsonSchema,setJsonSchema:e=>D({jsonSchema:e}),dataToInclude:i.dataToInclude,setDataToInclude:e=>D({dataToInclude:e}),loading:i.loading,handleSubmit:M,selectedContextEntity:i.selectedContextEntity,setSelectedContextEntity:e=>D({selectedContextEntity:e}),availableContextOptions:o,showJsonTab:i.showJsonTab,setShowJsonTab:e=>D({showJsonTab:e}),quotaAcknowledged:i.quotaAcknowledged,setQuotaAcknowledged:e=>D({quotaAcknowledged:e})})}),t.jsx(v,{name:"response",children:t.jsxs("div",{className:"flex flex-col",children:[i.responseText&&!i.loading&&!i.errorMessage&&t.jsx("div",{className:"flex justify-end mb-2",children:t.jsxs(_,{children:[t.jsx(d,{slot:"trigger",size:"small",variant:"text",caret:!0,className:"compact-copy-btn "+("check-circle"===E?"copy-success transition-colors duration-200":"text-body-and-labels"),children:t.jsx(n,{name:E})}),t.jsx(b,{children:$.map(e=>t.jsxs(N,{onClick:()=>q(e.format),children:[t.jsx(n,{slot:"prefix",name:e.icon}),t.jsx("span",{className:"ml-2",children:e.label})]},e.format))})]})}),t.jsx(Ye,{loading:i.loading,responseText:i.responseText,errorMessage:i.errorMessage})]})}),i.showJsonTab?t.jsx(v,{name:"json",children:t.jsxs("div",{className:"json-tab-section",children:[l?.falcon_context.socket_info&&t.jsxs("div",{children:[t.jsx("div",{className:"json-section-header",children:t.jsxs("h3",{className:"json-section-title",children:[t.jsx(n,{name:"diagram-3"}),"Socket Information"]})}),t.jsx("div",{className:"socket-info-container",children:t.jsxs("div",{className:"socket-info-grid",children:[t.jsxs("div",{className:"socket-info-row",children:[t.jsx("span",{className:"socket-info-label",children:"Current Socket:"}),t.jsx("span",{className:l.falcon_context.socket_info.detected?"socket-badge-detected":"socket-badge-unknown",children:l.falcon_context.socket_info.detected?l.falcon_context.socket_info.socket:"Unknown"})]}),t.jsxs("div",{className:"socket-info-row",children:[t.jsx("span",{className:"socket-info-label",children:"Page:"}),t.jsx("span",{className:"socket-info-text",children:l.falcon_context.socket_info.displayName})]}),t.jsxs("div",{className:"socket-info-row",children:[t.jsx("span",{className:"socket-info-label",children:"Description:"}),t.jsx("span",{className:"socket-info-description",children:l.falcon_context.socket_info.description})]}),t.jsxs("div",{className:"socket-info-row",children:[t.jsx("span",{className:"socket-info-label",children:"Detection Method:"}),t.jsx("span",{className:"socket-info-method",children:l.falcon_context.socket_info.detectionMethod})]})]})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"json-section-header",children:[t.jsxs("h3",{className:"json-section-title",children:[t.jsx(n,{name:"shield-check"}),"Context"]}),t.jsxs(d,{size:"small",onClick:f,className:"json-copy-button "+("check-circle"===w?"copy-success":""),children:[t.jsx(n,{slot:"prefix",name:w}),"check-circle"===w?"Copied!":"Copy Context"]})]}),t.jsx("div",{className:"json-content-container",children:t.jsx("pre",{className:"json-content-pre",children:l?.falcon_context?JSON.stringify(l.falcon_context,null,2):"No Falcon context available"})})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"json-section-header",children:[t.jsxs("h3",{className:"json-section-title",children:[t.jsx(n,{name:"arrow-up-circle"}),"Request"]}),t.jsxs(d,{size:"small",onClick:y,className:"json-copy-button "+("check-circle"===T?"copy-success":""),children:[t.jsx(n,{slot:"prefix",name:T}),"check-circle"===T?"Copied!":"Copy Request"]})]}),t.jsx("div",{className:"json-content-container",children:t.jsx("pre",{className:"json-content-pre",children:l?.request_data?JSON.stringify(l.request_data,null,2):"No request data available - select a query to populate"})})]}),i.responseText&&t.jsxs("div",{children:[t.jsxs("div",{className:"json-section-header",children:[t.jsxs("h3",{className:"json-section-title",children:[t.jsx(n,{name:"file-text"}),"Raw Response"]}),t.jsxs(d,{size:"small",onClick:()=>I(i.responseText),className:"json-copy-button "+("check-circle"===A?"copy-success":""),children:[t.jsx(n,{slot:"prefix",name:A}),"check-circle"===A?"Copied!":"Copy Raw Response"]})]}),t.jsx("div",{className:"raw-response-container",children:t.jsx("pre",{className:"raw-response-pre",children:i.responseText})})]}),i.hasSubmittedQuery&&!i.responseText&&!i.loading&&t.jsx("div",{className:"raw-response-container",children:t.jsx("div",{className:"raw-response-empty",children:"No response content available"})})]})}):null]})})})});function tt(){const{isInitialized:n,falcon:a,error:i,retry:r}=function(){const[t,s]=e.useState(!1),[n,a]=e.useState(null),i=e.useMemo(()=>new w,[]),r=async()=>{try{a(null),s(!1),await i.connect(),s(!0)}catch(e){const t=e instanceof Error?e.message:"Failed to initialize Falcon API";a(t),s(!1)}};return e.useEffect(()=>{r()},[i]),{falcon:i,isInitialized:t,error:n,retry:r}}();return i?t.jsxs("div",{className:"error-state p-6 rounded-lg",style:{backgroundColor:"var(--cs-background-base)",border:"1px solid var(--cs-border-color-light)",borderRadius:"var(--spacing-base)"},children:[t.jsx("h3",{className:"text-lg font-medium mb-2",style:{color:"var(--cs-status-error)"},children:"Failed to Initialize"}),t.jsxs("p",{className:"text-sm mb-4",style:{color:"var(--cs-text-primary)"},children:["Unable to connect to the Falcon API: ",i]}),t.jsx("button",{onClick:r,className:"px-4 py-2 rounded hover:opacity-80 focus:outline-none focus:ring-2",style:{backgroundColor:"var(--cs-status-error)",color:"var(--cs-text-on-primary)"},children:"Retry"})]}):n?t.jsx(k,{onRetry:r,children:t.jsx(s.StrictMode,{children:t.jsx("div",{className:"font-sans min-h-screen p-4",style:{fontFamily:"var(--font-family-sans)",color:"var(--cs-text-primary)",backgroundColor:"var(--cs-background-dark)",minHeight:"100vh",padding:"var(--spacing-xl)"},children:t.jsx(et,{falcon:a})})})}):t.jsx("div",{className:"loading-state flex items-center justify-center min-h-screen",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 mx-auto mb-4",style:{borderBottomColor:"var(--cs-primary)"}}),t.jsx("p",{style:{color:"var(--cs-text-primary)"},children:"Initializing..."})]})})}et.displayName="Home",T("https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/");window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("theme-dark"):document.documentElement.classList.remove("theme-dark"),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{e.matches?document.documentElement.classList.add("theme-dark"):document.documentElement.classList.remove("theme-dark")});const st=document.querySelector("#app");if(!st)throw new Error("Could not find app container element");j.createRoot(st).render(s.createElement(tt));